import{w as h}from"./DS7xxYIV.js";class s extends Error{constructor(e,r,n){super(e),this.userFriendly=r,this.originalError=n,this.name="AuthError"}}const i={INVALID_CREDENTIALS:{title:"Login Failed",message:"Incorrect email or password. Please try again."},NETWORK_ERROR:{title:"Connection Problem",message:"Unable to reach the server. Please check your internet connection and try again."},SERVER_ERROR:{title:"Server Error",message:"The server is experiencing issues. Please try again in a few moments."},EMAIL_EXISTS:{title:"Account Already Exists",message:"An account with this email already exists."},WEAK_PASSWORD:{title:"Weak Password",message:"Password must be at least 8 characters."},INVALID_EMAIL:{title:"Invalid Email",message:"Please enter a valid email address."},TIMEOUT:{title:"Request Timeout",message:"The request took too long. Please try again."}},c="/api";class g{async register(e,r,n){var t;try{const a=await fetch(`${c}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,username:r,password:n})});if(!a.ok){const l=await a.json();if(a.status===409)throw new s("Email exists",i.EMAIL_EXISTS);if(a.status>=500)throw new s("Server error",i.SERVER_ERROR);{const o=((t=l.error)==null?void 0:t.message)||l.error||"Registration failed";throw new s(typeof o=="string"?o:"Registration failed",{title:"Registration Failed",message:typeof o=="string"?o:"An unexpected error occurred."})}}}catch(a){throw a instanceof s?a:new s("Network error",i.NETWORK_ERROR,a)}}async login(e,r){var n;try{const t=await fetch(`${c}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:r})});if(!t.ok){const l=await t.json();if(t.status===401)throw new s("Invalid credentials",i.INVALID_CREDENTIALS);if(t.status>=500)throw new s("Server error",i.SERVER_ERROR);{const o=((n=l.error)==null?void 0:n.message)||l.error||"Login failed";throw new s(typeof o=="string"?o:"Login failed",{title:"Login Failed",message:typeof o=="string"?o:"An unexpected error occurred."})}}return await t.json()}catch(t){throw t instanceof s?t:new s("Network error",i.NETWORK_ERROR,t)}}async getMe(){const e=await fetch(`${c}/auth/me`,{credentials:"include"});if(!e.ok)throw new Error("Failed to get user info");return e.json()}logout(){fetch(`${c}/auth/logout`,{method:"POST",credentials:"include"}).catch(e=>console.error("Logout error:",e))}async getCharacters(){const e=await fetch(`${c}/game/characters`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch characters");return e.json()}async getSkills(e){const r=await fetch(`${c}/game/skills?character_id=${e}`,{credentials:"include"});if(!r.ok)throw r.status===404&&console.warn("Skills endpoint not found, returning empty skills"),new Error("Failed to fetch skills");return r.json()}}const E=new g;function u(){const{subscribe:d,set:e,update:r}=h({data:null,lastUpdate:0});return{subscribe:d,setMapData:n=>{r(t=>({...t,data:n,lastUpdate:Date.now()}))},clear:()=>e({data:null,lastUpdate:0})}}const R=u();export{E as g,R as m};
