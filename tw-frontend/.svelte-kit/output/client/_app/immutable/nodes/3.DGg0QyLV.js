var St=Object.defineProperty;var Et=(r,e,t)=>e in r?St(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var de=(r,e,t)=>Et(r,typeof e!="symbol"?e+"":e,t);import{r as De,s as _e,n as le,d as p,i as ee,e as c,l as $,c as u,f as m,g as x,h as J,j,m as v,o as V,Z as Re,_ as He,a as ne,k as Q,t as X,z as Oe,b as Be,u as It,q as xt,A as Tt,$ as be,a0 as Dt,x as jt,T as Vt,U as Ft,a1 as Mt,a2 as Pt}from"../chunks/vUR8X68U.js";import{a as ce,S as ye,i as we,d as Se,t as fe,m as Ee,e as Ie,b as Te,c as ze,g as qe}from"../chunks/BYitGVcx.js";import{g as et}from"../chunks/B9bp65Jp.js";import{m as kt,g as Le}from"../chunks/wQArxclW.js";import{w as Ue}from"../chunks/DS7xxYIV.js";function ve(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function zt(r,e){r.d(1),e.delete(r.key)}function qt(r,e,t,s,l,i,n,o,a,g,d,f){let b=r.length,C=i.length,y=b;const D={};for(;y--;)D[r[y].key]=y;const F=[],E=new Map,w=new Map,A=[];for(y=C;y--;){const k=f(l,i,y),P=t(k);let q=n.get(P);q?A.push(()=>q.p(k,e)):(q=g(P,k),q.c()),E.set(P,F[y]=q),P in D&&w.set(P,Math.abs(y-D[P]))}const M=new Set,S=new Set;function O(k){ce(k,1),k.m(o,d),n.set(k.key,k),d=k.first,C--}for(;b&&C;){const k=F[C-1],P=r[b-1],q=k.key,L=P.key;k===P?(d=k.first,b--,C--):E.has(L)?!n.has(q)||M.has(q)?O(k):S.has(L)?b--:w.get(q)>w.get(L)?(S.add(q),O(k)):(M.add(L),b--):(a(P,n),b--)}for(;b--;){const k=r[b];E.has(k.key)||a(k,n)}for(;C;)O(F[C-1]);return De(A),F}const Lt="mud-command-queue",Nt=1,ue="commands",At=3;class Ot{constructor(){de(this,"db",null);de(this,"isProcessing",!1)}async init(){return new Promise((e,t)=>{const s=indexedDB.open(Lt,Nt);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=l=>{const i=l.target.result;if(!i.objectStoreNames.contains(ue)){const n=i.createObjectStore(ue,{keyPath:"id"});n.createIndex("status","status",{unique:!1}),n.createIndex("timestamp","timestamp",{unique:!1})}}})}async enqueue(e){if(!this.db)throw new Error("Database not initialized");const t={id:crypto.randomUUID(),text:e,timestamp:Date.now(),retryCount:0,status:"pending"};return new Promise((s,l)=>{const o=this.db.transaction([ue],"readwrite").objectStore(ue).add(t);o.onsuccess=()=>s(t.id),o.onerror=()=>l(o.error)})}async getPending(){return this.db?new Promise((e,t)=>{const n=this.db.transaction([ue],"readonly").objectStore(ue).index("status").getAll("pending");n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}):[]}async getPendingCount(){return this.db?new Promise((e,t)=>{const n=this.db.transaction([ue],"readonly").objectStore(ue).index("status").count("pending");n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)}):0}async processQueue(e){if(!(!this.db||this.isProcessing)){this.isProcessing=!0;try{const t=await this.getPending();for(const s of t){await this.updateStatus(s.id,"processing");try{await e(s.text),await this.remove(s.id)}catch(l){console.error("Failed to send queued command:",l),s.retryCount<At?await this.incrementRetry(s.id):await this.updateStatus(s.id,"failed")}}}finally{this.isProcessing=!1}}}async clearFailed(){if(this.db)return new Promise((e,t)=>{const n=this.db.transaction([ue],"readwrite").objectStore(ue).index("status").openCursor(IDBKeyRange.only("failed"));n.onsuccess=o=>{const a=o.target.result;a?(a.delete(),a.continue()):e()},n.onerror=()=>t(n.error)})}async updateStatus(e,t){if(this.db)return new Promise((s,l)=>{const n=this.db.transaction([ue],"readwrite").objectStore(ue),o=n.get(e);o.onsuccess=()=>{const a=o.result;if(a){a.status=t;const g=n.put(a);g.onsuccess=()=>s(),g.onerror=()=>l(g.error)}else s()},o.onerror=()=>l(o.error)})}async incrementRetry(e){if(this.db)return new Promise((t,s)=>{const i=this.db.transaction([ue],"readwrite").objectStore(ue),n=i.get(e);n.onsuccess=()=>{const o=n.result;if(o){o.retryCount++,o.status="pending";const a=i.put(o);a.onsuccess=()=>t(),a.onerror=()=>s(a.error)}else t()},n.onerror=()=>s(n.error)})}async remove(e){if(this.db)return new Promise((t,s)=>{const n=this.db.transaction([ue],"readwrite").objectStore(ue).delete(e);n.onsuccess=()=>t(),n.onerror=()=>s(n.error)})}close(){this.db&&(this.db.close(),this.db=null)}}const We=new Ot;class Bt{constructor(){de(this,"ws",null);de(this,"reconnectAttempts",0);de(this,"maxReconnectAttempts",5);de(this,"reconnectDelay",1e3);de(this,"currentCharacterId");de(this,"isIntentionalDisconnect",!1);de(this,"connected",Ue(!1));de(this,"pendingCommands",Ue(0));de(this,"messageHandlers",new Set)}connect(e){console.log("[WebSocket] Attempting to connect...",{characterId:e}),this.isIntentionalDisconnect=!1,e&&(this.currentCharacterId=e);const t=window.location.protocol==="https:"?"wss:":"ws:",s=window.location.host;let l=`${t}//${s}/api/game/ws`;this.currentCharacterId&&(l+=`?character_id=${encodeURIComponent(this.currentCharacterId)}`),console.log("[WebSocket] URL:",l);try{this.ws=new WebSocket(l),console.log("[WebSocket] WebSocket object created"),this.ws.onopen=()=>{console.log("[WebSocket] Connection opened!"),this.connected.set(!0),this.reconnectAttempts=0,this.processQueuedCommands()},this.ws.onmessage=i=>{try{const o=i.data.toString().split(`
`).filter(a=>a.trim()!=="");for(const a of o)try{const g=JSON.parse(a);console.log("[WebSocket] Message received:",g),this.handleMessage(g)}catch(g){console.error("[WebSocket] Failed to parse message part:",g)}}catch(n){console.error("[WebSocket] Failed to process message:",n),console.log("[WebSocket] Raw data:",i.data)}},this.ws.onerror=i=>{console.error("[WebSocket] Error:",i)},this.ws.onclose=()=>{console.log("[WebSocket] Connection closed"),this.connected.set(!1),this.isIntentionalDisconnect||this.attemptReconnect()}}catch(i){console.error("[WebSocket] Failed to create WebSocket:",i)}}disconnect(){this.isIntentionalDisconnect=!0,this.ws&&(this.ws.close(),this.ws=null),this.connected.set(!1)}sendRawCommand(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.error("WebSocket not connected");return}const t={type:"command",data:{text:e}};this.ws.send(JSON.stringify(t))}async sendCommandWithQueue(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){await We.enqueue(e),await this.updatePendingCount(),console.log("Command queued for later sending");return}this.sendRawCommand(e)}async processQueuedCommands(){try{await We.processQueue(async e=>new Promise((t,s)=>{if(!this.ws||this.ws.readyState!==WebSocket.OPEN){s(new Error("WebSocket not connected"));return}const l={type:"command",data:{text:e}};this.ws.send(JSON.stringify(l)),t()})),await this.updatePendingCount()}catch(e){console.error("Error processing queued commands:",e)}}async updatePendingCount(){const e=await We.getPendingCount();this.pendingCommands.set(e)}onMessage(e){return this.messageHandlers.add(e),()=>{this.messageHandlers.delete(e)}}handleMessage(e){e.type==="map_update"&&e.data&&kt.setMapData(e.data),this.messageHandlers.forEach(t=>{try{t(e)}catch(s){console.error("Message handler error:",s)}})}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnect attempts reached");return}this.reconnectAttempts++;const e=this.reconnectDelay*this.reconnectAttempts;console.log(`Reconnecting in ${e}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{this.connect(this.currentCharacterId)},e)}}const pe=new Bt;function tt(r,e,t){const s=r.slice();return s[7]=e[t],s}function st(r){let e,t=`<div class="flex items-center justify-between mb-2"><h3 class="text-lg font-bold text-gray-200 group-hover:text-blue-300">Watcher</h3> <span class="text-xs bg-blue-900/50 text-blue-300 px-2 py-1 rounded border border-blue-500/30">Invisible</span></div> <p class="text-gray-400 text-sm">Enter as an invisible observer. You can explore freely
                        without stamina cost, but cannot interact with the
                        world.</p>`,s,l;return{c(){e=v("button"),e.innerHTML=t,this.h()},l(i){e=m(i,"BUTTON",{class:!0,"data-testid":!0,"data-svelte-h":!0}),J(e)!=="svelte-fazf1p"&&(e.innerHTML=t),this.h()},h(){u(e,"class","p-4 border border-gray-700 hover:border-blue-400 hover:bg-blue-900/20 rounded text-left transition-all group"),u(e,"data-testid","entry-option-watcher")},m(i,n){ee(i,e,n),s||(l=$(e,"click",r[2]),s=!0)},p:le,d(i){i&&p(e),s=!1,l()}}}function nt(r){let e,t,s='<h3 class="text-lg font-bold text-gray-200">Inhabit Existing NPC</h3> <span class="text-xs text-gray-500">Select a life to take over</span>',l,i,n=ve(r[0].available_npcs),o=[];for(let a=0;a<n.length;a+=1)o[a]=rt(tt(r,n,a));return{c(){e=v("div"),t=v("div"),t.innerHTML=s,l=V(),i=v("div");for(let a=0;a<o.length;a+=1)o[a].c();this.h()},l(a){e=m(a,"DIV",{class:!0});var g=x(e);t=m(g,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-11j9379"&&(t.innerHTML=s),l=j(g),i=m(g,"DIV",{class:!0});var d=x(i);for(let f=0;f<o.length;f+=1)o[f].l(d);d.forEach(p),g.forEach(p),this.h()},h(){u(t,"class","flex items-center justify-between"),u(i,"class","grid grid-cols-1 md:grid-cols-2 gap-3"),u(e,"class","space-y-3")},m(a,g){ee(a,e,g),c(e,t),c(e,l),c(e,i);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(i,null)},p(a,g){if(g&3){n=ve(a[0].available_npcs);let d;for(d=0;d<n.length;d+=1){const f=tt(a,n,d);o[d]?o[d].p(f,g):(o[d]=rt(f),o[d].c(),o[d].m(i,null))}for(;d<o.length;d+=1)o[d].d(1);o.length=n.length}},d(a){a&&p(e),He(o,a)}}}function rt(r){let e,t,s=r[7].name+"",l,i,n,o=r[7].species+"",a,g,d=r[7].occupation+"",f,b,C,y=r[7].description+"",D,F,E,w;function A(){return r[3](r[7])}return{c(){e=v("button"),t=v("div"),l=X(s),i=V(),n=v("div"),a=X(o),g=X(" â€¢ "),f=X(d),b=V(),C=v("div"),D=X(y),F=V(),this.h()},l(M){e=m(M,"BUTTON",{class:!0,"data-testid":!0});var S=x(e);t=m(S,"DIV",{class:!0});var O=x(t);l=Q(O,s),O.forEach(p),i=j(S),n=m(S,"DIV",{class:!0});var k=x(n);a=Q(k,o),g=Q(k," â€¢ "),f=Q(k,d),k.forEach(p),b=j(S),C=m(S,"DIV",{class:!0});var P=x(C);D=Q(P,y),P.forEach(p),F=j(S),S.forEach(p),this.h()},h(){u(t,"class","font-bold text-green-300 group-hover:text-green-200 mb-1"),u(n,"class","text-xs text-gray-400 mb-2 font-mono"),u(C,"class","text-xs text-gray-500 flex-1"),u(e,"class","p-3 border border-gray-700 hover:border-green-400 hover:bg-green-900/20 rounded text-left transition-all group h-full flex flex-col"),u(e,"data-testid","entry-option-npc")},m(M,S){ee(M,e,S),c(e,t),c(t,l),c(e,i),c(e,n),c(n,a),c(n,g),c(n,f),c(e,b),c(e,C),c(C,D),c(e,F),E||(w=$(e,"click",A),E=!0)},p(M,S){r=M,S&1&&s!==(s=r[7].name+"")&&ne(l,s),S&1&&o!==(o=r[7].species+"")&&ne(a,o),S&1&&d!==(d=r[7].occupation+"")&&ne(f,d),S&1&&y!==(y=r[7].description+"")&&ne(D,y)},d(M){M&&p(e),E=!1,w()}}}function it(r){let e,t=`<div class="flex items-center justify-between mb-2"><h3 class="text-lg font-bold text-gray-200 group-hover:text-purple-300">Create New Character</h3> <span class="text-xs bg-purple-900/50 text-purple-300 px-2 py-1 rounded border border-purple-500/30">Custom</span></div> <p class="text-gray-400 text-sm">Design your own character from scratch. Choose your
                        species, name, and attributes.</p>`,s,l;return{c(){e=v("button"),e.innerHTML=t,this.h()},l(i){e=m(i,"BUTTON",{class:!0,"data-testid":!0,"data-svelte-h":!0}),J(e)!=="svelte-1pjs6al"&&(e.innerHTML=t),this.h()},h(){u(e,"class","p-4 border border-gray-700 hover:border-purple-400 hover:bg-purple-900/20 rounded text-left transition-all group"),u(e,"data-testid","entry-option-custom")},m(i,n){ee(i,e,n),s||(l=$(e,"click",r[4]),s=!0)},p:le,d(i){i&&p(e),s=!1,l()}}}function Rt(r){let e,t,s,l="Choose Your Path",i,n,o,a,g,d,f,b="Cancel",C,y,D=r[0].can_enter_as_watcher&&st(r),F=r[0].available_npcs&&r[0].available_npcs.length>0&&nt(r),E=r[0].can_create_custom&&it(r);return{c(){e=v("div"),t=v("div"),s=v("h2"),s.textContent=l,i=V(),n=v("div"),D&&D.c(),o=V(),F&&F.c(),a=V(),E&&E.c(),g=V(),d=v("div"),f=v("button"),f.textContent=b,this.h()},l(w){e=m(w,"DIV",{class:!0});var A=x(e);t=m(A,"DIV",{class:!0});var M=x(t);s=m(M,"H2",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-1p3hd72"&&(s.textContent=l),i=j(M),n=m(M,"DIV",{class:!0});var S=x(n);D&&D.l(S),o=j(S),F&&F.l(S),a=j(S),E&&E.l(S),S.forEach(p),g=j(M),d=m(M,"DIV",{class:!0});var O=x(d);f=m(O,"BUTTON",{class:!0,"data-svelte-h":!0}),J(f)!=="svelte-1087po9"&&(f.textContent=b),O.forEach(p),M.forEach(p),A.forEach(p),this.h()},h(){u(s,"class","text-2xl font-bold text-blue-400 mb-6 text-center font-mono uppercase tracking-widest"),u(n,"class","grid gap-6"),u(f,"class","text-gray-500 hover:text-gray-300 text-sm underline"),u(d,"class","mt-6 text-center"),u(t,"class","bg-gray-900 border border-blue-500/50 p-6 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto"),u(e,"class","fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4")},m(w,A){ee(w,e,A),c(e,t),c(t,s),c(t,i),c(t,n),D&&D.m(n,null),c(n,o),F&&F.m(n,null),c(n,a),E&&E.m(n,null),c(t,g),c(t,d),c(d,f),C||(y=$(f,"click",r[5]),C=!0)},p(w,[A]){w[0].can_enter_as_watcher?D?D.p(w,A):(D=st(w),D.c(),D.m(n,o)):D&&(D.d(1),D=null),w[0].available_npcs&&w[0].available_npcs.length>0?F?F.p(w,A):(F=nt(w),F.c(),F.m(n,a)):F&&(F.d(1),F=null),w[0].can_create_custom?E?E.p(w,A):(E=it(w),E.c(),E.m(n,null)):E&&(E.d(1),E=null)},i:le,o:le,d(w){w&&p(e),D&&D.d(),F&&F.d(),E&&E.d(),C=!1,y()}}}function Ht(r,e,t){let{options:s}=e;const l=Re();function i(d,f){l("select",{type:d,data:f})}const n=()=>i("watcher"),o=d=>i("npc",d),a=()=>i("custom"),g=()=>i("cancel");return r.$$set=d=>{"options"in d&&t(0,s=d.options)},[s,i,n,o,a,g]}class Wt extends ye{constructor(e){super(),we(this,e,Ht,Rt,_e,{options:0})}}function lt(r,e,t){const s=r.slice();return s[15]=e[t],s}function ot(r){let e,t,s="Attributes",l,i,n,o,a="Strength",g,d,f,b,C,y,D="Dexterity",F,E,w,A,M,S,O="Constitution",k,P,q,L,G,W,te="Intelligence",ie,T,Y,ge,ae,B,N="Wisdom",Z,R,he,K,_,h,I="Charisma",z,H,se;return{c(){e=v("div"),t=v("h3"),t.textContent=s,l=V(),i=v("div"),n=v("div"),o=v("div"),o.textContent=a,g=V(),d=v("div"),f=X(r[4]),b=V(),C=v("div"),y=v("div"),y.textContent=D,F=V(),E=v("div"),w=X(r[5]),A=V(),M=v("div"),S=v("div"),S.textContent=O,k=V(),P=v("div"),q=X(r[6]),L=V(),G=v("div"),W=v("div"),W.textContent=te,ie=V(),T=v("div"),Y=X(r[7]),ge=V(),ae=v("div"),B=v("div"),B.textContent=N,Z=V(),R=v("div"),he=X(r[8]),K=V(),_=v("div"),h=v("div"),h.textContent=I,z=V(),H=v("div"),se=X(r[9]),this.h()},l(re){e=m(re,"DIV",{});var U=x(e);t=m(U,"H3",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-997l6d"&&(t.textContent=s),l=j(U),i=m(U,"DIV",{class:!0});var oe=x(i);n=m(oe,"DIV",{class:!0});var me=x(n);o=m(me,"DIV",{class:!0,"data-svelte-h":!0}),J(o)!=="svelte-15on3nb"&&(o.textContent=a),g=j(me),d=m(me,"DIV",{class:!0});var xe=x(d);f=Q(xe,r[4]),xe.forEach(p),me.forEach(p),b=j(oe),C=m(oe,"DIV",{class:!0});var je=x(C);y=m(je,"DIV",{class:!0,"data-svelte-h":!0}),J(y)!=="svelte-qkib5i"&&(y.textContent=D),F=j(je),E=m(je,"DIV",{class:!0});var Ye=x(E);w=Q(Ye,r[5]),Ye.forEach(p),je.forEach(p),A=j(oe),M=m(oe,"DIV",{class:!0});var Ve=x(M);S=m(Ve,"DIV",{class:!0,"data-svelte-h":!0}),J(S)!=="svelte-r3xn11"&&(S.textContent=O),k=j(Ve),P=m(Ve,"DIV",{class:!0});var Ge=x(P);q=Q(Ge,r[6]),Ge.forEach(p),Ve.forEach(p),L=j(oe),G=m(oe,"DIV",{class:!0});var Fe=x(G);W=m(Fe,"DIV",{class:!0,"data-svelte-h":!0}),J(W)!=="svelte-11y7hwx"&&(W.textContent=te),ie=j(Fe),T=m(Fe,"DIV",{class:!0});var Ke=x(T);Y=Q(Ke,r[7]),Ke.forEach(p),Fe.forEach(p),ge=j(oe),ae=m(oe,"DIV",{class:!0});var Me=x(ae);B=m(Me,"DIV",{class:!0,"data-svelte-h":!0}),J(B)!=="svelte-simxrd"&&(B.textContent=N),Z=j(Me),R=m(Me,"DIV",{class:!0});var Ze=x(R);he=Q(Ze,r[8]),Ze.forEach(p),Me.forEach(p),K=j(oe),_=m(oe,"DIV",{class:!0});var Pe=x(_);h=m(Pe,"DIV",{class:!0,"data-svelte-h":!0}),J(h)!=="svelte-141kacq"&&(h.textContent=I),z=j(Pe),H=m(Pe,"DIV",{class:!0});var $e=x(H);se=Q($e,r[9]),$e.forEach(p),Pe.forEach(p),oe.forEach(p),U.forEach(p),this.h()},h(){u(t,"class","text-lg font-bold text-gray-100 mb-2 sr-only"),u(o,"class","text-xs text-gray-400"),u(d,"class","text-xl font-bold text-red-400"),u(n,"class","bg-gray-800 rounded p-2"),u(y,"class","text-xs text-gray-400"),u(E,"class","text-xl font-bold text-green-400"),u(C,"class","bg-gray-800 rounded p-2"),u(S,"class","text-xs text-gray-400"),u(P,"class","text-xl font-bold text-orange-400"),u(M,"class","bg-gray-800 rounded p-2"),u(W,"class","text-xs text-gray-400"),u(T,"class","text-xl font-bold text-blue-400"),u(G,"class","bg-gray-800 rounded p-2"),u(B,"class","text-xs text-gray-400"),u(R,"class","text-xl font-bold text-cyan-400"),u(ae,"class","bg-gray-800 rounded p-2"),u(h,"class","text-xs text-gray-400"),u(H,"class","text-xl font-bold text-purple-400"),u(_,"class","bg-gray-800 rounded p-2"),u(i,"class","grid grid-cols-2 gap-2")},m(re,U){ee(re,e,U),c(e,t),c(e,l),c(e,i),c(i,n),c(n,o),c(n,g),c(n,d),c(d,f),c(i,b),c(i,C),c(C,y),c(C,F),c(C,E),c(E,w),c(i,A),c(i,M),c(M,S),c(M,k),c(M,P),c(P,q),c(i,L),c(i,G),c(G,W),c(G,ie),c(G,T),c(T,Y),c(i,ge),c(i,ae),c(ae,B),c(ae,Z),c(ae,R),c(R,he),c(i,K),c(i,_),c(_,h),c(_,z),c(_,H),c(H,se)},p(re,U){U&16&&ne(f,re[4]),U&32&&ne(w,re[5]),U&64&&ne(q,re[6]),U&128&&ne(Y,re[7]),U&256&&ne(he,re[8]),U&512&&ne(se,re[9])},d(re){re&&p(e)}}}function at(r){let e,t,s="Skills",l,i;function n(g,d){return d&1024&&(i=null),i==null&&(i=Object.keys(g[10]).length===0),i?Qt:Ut}let o=n(r,-1),a=o(r);return{c(){e=v("div"),t=v("h3"),t.textContent=s,l=V(),a.c(),this.h()},l(g){e=m(g,"DIV",{class:!0});var d=x(e);t=m(d,"H3",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-8zem0i"&&(t.textContent=s),l=j(d),a.l(d),d.forEach(p),this.h()},h(){u(t,"class","text-lg font-bold text-gray-100 mb-2 sr-only"),u(e,"class","mt-0")},m(g,d){ee(g,e,d),c(e,t),c(e,l),a.m(e,null)},p(g,d){o===(o=n(g,d))&&a?a.p(g,d):(a.d(1),a=o(g),a&&(a.c(),a.m(e,null)))},d(g){g&&p(e),a.d()}}}function Ut(r){let e,t=ve(Object.values(r[10])),s=[];for(let l=0;l<t.length;l+=1)s[l]=ct(lt(r,t,l));return{c(){e=v("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=m(l,"DIV",{class:!0});var i=x(e);for(let n=0;n<s.length;n+=1)s[n].l(i);i.forEach(p),this.h()},h(){u(e,"class","grid grid-cols-1 gap-2")},m(l,i){ee(l,e,i);for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(e,null)},p(l,i){if(i&1024){t=ve(Object.values(l[10]));let n;for(n=0;n<t.length;n+=1){const o=lt(l,t,n);s[n]?s[n].p(o,i):(s[n]=ct(o),s[n].c(),s[n].m(e,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=t.length}},d(l){l&&p(e),He(s,l)}}}function Qt(r){let e,t="No skills learned yet.";return{c(){e=v("div"),e.textContent=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1j49tet"&&(e.textContent=t),this.h()},h(){u(e,"class","text-gray-500 text-sm italic py-4 text-center")},m(s,l){ee(s,e,l)},p:le,d(s){s&&p(e)}}}function ct(r){let e,t,s,l=r[15].name+"",i,n,o,a=r[15].category+"",g,d,f,b,C,y=r[15].level+"",D,F,E,w=r[15].xp+"",A,M,S;return{c(){e=v("div"),t=v("div"),s=v("div"),i=X(l),n=V(),o=v("div"),g=X(a),d=V(),f=v("div"),b=v("div"),C=X("Level "),D=X(y),F=V(),E=v("div"),A=X(w),M=X(" XP"),S=V(),this.h()},l(O){e=m(O,"DIV",{class:!0});var k=x(e);t=m(k,"DIV",{});var P=x(t);s=m(P,"DIV",{class:!0});var q=x(s);i=Q(q,l),q.forEach(p),n=j(P),o=m(P,"DIV",{class:!0});var L=x(o);g=Q(L,a),L.forEach(p),P.forEach(p),d=j(k),f=m(k,"DIV",{class:!0});var G=x(f);b=m(G,"DIV",{class:!0});var W=x(b);C=Q(W,"Level "),D=Q(W,y),W.forEach(p),F=j(G),E=m(G,"DIV",{class:!0});var te=x(E);A=Q(te,w),M=Q(te," XP"),te.forEach(p),G.forEach(p),S=j(k),k.forEach(p),this.h()},h(){u(s,"class","text-sm font-bold text-gray-200"),u(o,"class","text-xs text-gray-400"),u(b,"class","text-sm font-mono text-blue-400"),u(E,"class","text-xs text-gray-500"),u(f,"class","text-right"),u(e,"class","bg-gray-800 rounded p-2 flex justify-between items-center")},m(O,k){ee(O,e,k),c(e,t),c(t,s),c(s,i),c(t,n),c(t,o),c(o,g),c(e,d),c(e,f),c(f,b),c(b,C),c(b,D),c(f,F),c(f,E),c(E,A),c(E,M),c(e,S)},p(O,k){k&1024&&l!==(l=O[15].name+"")&&ne(i,l),k&1024&&a!==(a=O[15].category+"")&&ne(g,a),k&1024&&y!==(y=O[15].level+"")&&ne(D,y),k&1024&&w!==(w=O[15].xp+"")&&ne(A,w)},d(O){O&&p(e)}}}function Xt(r){let e,t,s,l,i,n,o,a,g,d,f,b,C="Experience",y,D,F,E,w,A,M,S,O,k,P,q,L,G,W,te,ie,T,Y,ge,ae,B=r[11]==="stats"&&ot(r),N=r[11]==="skills"&&at(r);return{c(){e=v("div"),t=v("div"),s=v("h2"),l=X(r[0]),i=V(),n=v("div"),o=X("Level "),a=X(r[1]),g=V(),d=v("div"),f=v("div"),b=v("span"),b.textContent=C,y=V(),D=v("span"),F=X(r[2]),E=X("/"),w=X(r[3]),A=V(),M=v("div"),S=v("div"),O=V(),k=v("div"),P=v("button"),q=X("Stats"),G=V(),W=v("button"),te=X("Skills"),T=V(),B&&B.c(),Y=V(),N&&N.c(),this.h()},l(Z){e=m(Z,"DIV",{class:!0});var R=x(e);t=m(R,"DIV",{class:!0});var he=x(t);s=m(he,"H2",{class:!0});var K=x(s);l=Q(K,r[0]),K.forEach(p),i=j(he),n=m(he,"DIV",{class:!0});var _=x(n);o=Q(_,"Level "),a=Q(_,r[1]),_.forEach(p),g=j(he),d=m(he,"DIV",{class:!0});var h=x(d);f=m(h,"DIV",{class:!0});var I=x(f);b=m(I,"SPAN",{"data-svelte-h":!0}),J(b)!=="svelte-9tuuyy"&&(b.textContent=C),y=j(I),D=m(I,"SPAN",{});var z=x(D);F=Q(z,r[2]),E=Q(z,"/"),w=Q(z,r[3]),z.forEach(p),I.forEach(p),A=j(h),M=m(h,"DIV",{class:!0});var H=x(M);S=m(H,"DIV",{class:!0,style:!0}),x(S).forEach(p),H.forEach(p),h.forEach(p),he.forEach(p),O=j(R),k=m(R,"DIV",{class:!0});var se=x(k);P=m(se,"BUTTON",{class:!0});var re=x(P);q=Q(re,"Stats"),re.forEach(p),G=j(se),W=m(se,"BUTTON",{class:!0});var U=x(W);te=Q(U,"Skills"),U.forEach(p),se.forEach(p),T=j(R),B&&B.l(R),Y=j(R),N&&N.l(R),R.forEach(p),this.h()},h(){u(s,"class","text-2xl font-bold text-gray-100"),u(n,"class","text-gray-400"),u(f,"class","flex justify-between text-xs text-gray-400 mb-1"),u(S,"class","bg-purple-500 h-2 rounded-full transition-all"),Oe(S,"width",r[12]+"%"),u(M,"class","w-full bg-gray-700 rounded-full h-2"),u(d,"class","mt-2"),u(t,"class","mb-4"),u(P,"class",L="flex-1 py-2 text-center text-sm font-bold uppercase transition-colors "+(r[11]==="stats"?"text-blue-400 border-b-2 border-blue-400":"text-gray-500 hover:text-gray-300")),u(W,"class",ie="flex-1 py-2 text-center text-sm font-bold uppercase transition-colors "+(r[11]==="skills"?"text-blue-400 border-b-2 border-blue-400":"text-gray-500 hover:text-gray-300")),u(k,"class","flex border-b border-gray-700 mb-4"),u(e,"class","character-sheet bg-gray-900 rounded-lg p-4 w-full max-w-md mx-auto max-h-[80vh] overflow-y-auto")},m(Z,R){ee(Z,e,R),c(e,t),c(t,s),c(s,l),c(t,i),c(t,n),c(n,o),c(n,a),c(t,g),c(t,d),c(d,f),c(f,b),c(f,y),c(f,D),c(D,F),c(D,E),c(D,w),c(d,A),c(d,M),c(M,S),c(e,O),c(e,k),c(k,P),c(P,q),c(k,G),c(k,W),c(W,te),c(e,T),B&&B.m(e,null),c(e,Y),N&&N.m(e,null),ge||(ae=[$(P,"click",r[13]),$(W,"click",r[14])],ge=!0)},p(Z,[R]){R&1&&ne(l,Z[0]),R&2&&ne(a,Z[1]),R&4&&ne(F,Z[2]),R&8&&ne(w,Z[3]),R&4096&&Oe(S,"width",Z[12]+"%"),R&2048&&L!==(L="flex-1 py-2 text-center text-sm font-bold uppercase transition-colors "+(Z[11]==="stats"?"text-blue-400 border-b-2 border-blue-400":"text-gray-500 hover:text-gray-300"))&&u(P,"class",L),R&2048&&ie!==(ie="flex-1 py-2 text-center text-sm font-bold uppercase transition-colors "+(Z[11]==="skills"?"text-blue-400 border-b-2 border-blue-400":"text-gray-500 hover:text-gray-300"))&&u(W,"class",ie),Z[11]==="stats"?B?B.p(Z,R):(B=ot(Z),B.c(),B.m(e,Y)):B&&(B.d(1),B=null),Z[11]==="skills"?N?N.p(Z,R):(N=at(Z),N.c(),N.m(e,null)):N&&(N.d(1),N=null)},i:le,o:le,d(Z){Z&&p(e),B&&B.d(),N&&N.d(),ge=!1,De(ae)}}}function Jt(r,e,t){let s,{characterName:l="Adventurer"}=e,{level:i=1}=e,{experience:n=0}=e,{nextLevelXP:o=100}=e,{strength:a=10}=e,{dexterity:g=10}=e,{constitution:d=10}=e,{intelligence:f=10}=e,{wisdom:b=10}=e,{charisma:C=10}=e,{skills:y={}}=e,D="stats";const F=()=>t(11,D="stats"),E=()=>t(11,D="skills");return r.$$set=w=>{"characterName"in w&&t(0,l=w.characterName),"level"in w&&t(1,i=w.level),"experience"in w&&t(2,n=w.experience),"nextLevelXP"in w&&t(3,o=w.nextLevelXP),"strength"in w&&t(4,a=w.strength),"dexterity"in w&&t(5,g=w.dexterity),"constitution"in w&&t(6,d=w.constitution),"intelligence"in w&&t(7,f=w.intelligence),"wisdom"in w&&t(8,b=w.wisdom),"charisma"in w&&t(9,C=w.charisma),"skills"in w&&t(10,y=w.skills)},r.$$.update=()=>{r.$$.dirty&12&&t(12,s=n/o*100)},[l,i,n,o,a,g,d,f,b,C,y,D,s,F,E]}class Yt extends ye{constructor(e){super(),we(this,e,Jt,Xt,_e,{characterName:0,level:1,experience:2,nextLevelXP:3,strength:4,dexterity:5,constitution:6,intelligence:7,wisdom:8,charisma:9,skills:10})}}const Gt={light:10,medium:15,heavy:20,selection:5,error:[10,50,10],success:[10,50,10,50,10]},Xe=Ue(!0);if(typeof localStorage<"u"){const r=localStorage.getItem("hapticEnabled");r!==null&&Xe.set(r==="true")}Xe.subscribe(r=>{typeof localStorage<"u"&&localStorage.setItem("hapticEnabled",String(r))});let Ct=!0;Xe.subscribe(r=>{Ct=r});function ke(r){if(!Ct||!("vibrate"in navigator))return;const e=Gt[r];Array.isArray(e),navigator.vibrate(e)}const Je={light:()=>ke("light"),medium:()=>ke("medium"),heavy:()=>ke("heavy"),selection:()=>ke("selection"),error:()=>ke("error"),success:()=>ke("success")};function Kt(r){let e,t,s,l,i,n,o,a;return{c(){e=v("div"),t=v("input"),s=V(),l=v("button"),i=X("Send"),this.h()},l(g){e=m(g,"DIV",{class:!0});var d=x(e);t=m(d,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0,style:!0,autocomplete:!0,autocorrect:!0,autocapitalize:!0,spellcheck:!0}),s=j(d),l=m(d,"BUTTON",{class:!0,"aria-label":!0});var f=x(l);i=Q(f,"Send"),f.forEach(p),d.forEach(p),this.h()},h(){u(t,"id","game-input"),u(t,"type","text"),u(t,"placeholder","Enter command..."),u(t,"class","flex-1 px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-gray-100 text-base placeholder-gray-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 svelte-1o25vz6"),Oe(t,"font-size","16px"),u(t,"autocomplete","off"),u(t,"autocorrect","off"),u(t,"autocapitalize","off"),u(t,"spellcheck","false"),l.disabled=n=!r[0].trim(),u(l,"class","min-w-[44px] min-h-[44px] px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 disabled:text-gray-500 text-white font-semibold rounded-lg transition-colors flex items-center justify-center"),u(l,"aria-label","Send command"),u(e,"class","flex gap-2 w-full")},m(g,d){ee(g,e,d),c(e,t),Be(t,r[0]),c(e,s),c(e,l),c(l,i),o||(a=[$(t,"input",r[3]),$(t,"keydown",r[2]),$(l,"click",r[1])],o=!0)},p(g,[d]){d&1&&t.value!==g[0]&&Be(t,g[0]),d&1&&n!==(n=!g[0].trim())&&(l.disabled=n)},i:le,o:le,d(g){g&&p(e),o=!1,De(a)}}}function Zt(r,e,t){const s=Re();let l="",i=[],n=-1;function o(){l.trim()&&(Je.light(),s("submit",l.trim()),i.unshift(l),i.length>50&&i.pop(),t(0,l=""),n=-1)}function a(d){d.key==="Enter"&&!d.shiftKey?(d.preventDefault(),o()):d.key==="ArrowUp"?(d.preventDefault(),n<i.length-1&&(n++,t(0,l=i[n]))):d.key==="ArrowDown"?(d.preventDefault(),n>0?(n--,t(0,l=i[n])):n===0&&(n=-1,t(0,l=""))):d.key==="Escape"&&(t(0,l=""),n=-1)}function g(){l=this.value,t(0,l)}return[l,o,a,g]}class $t extends ye{constructor(e){super(),we(this,e,Zt,Kt,_e,{})}}function es(r){let e,t,s='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(-45deg)"><path d="m18 15-6-6-6 6"></path></svg>',l,i,n='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 15-6-6-6 6"></path></svg>',o,a,g='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg)"><path d="m18 15-6-6-6 6"></path></svg>',d,f,b='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(-90deg)"><path d="m18 15-6-6-6 6"></path></svg>',C,y,D="LOOK",F,E,w='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(90deg)"><path d="m18 15-6-6-6 6"></path></svg>',A,M,S='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(-135deg)"><path d="m18 15-6-6-6 6"></path></svg>',O,k,P='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(180deg)"><path d="m18 15-6-6-6 6"></path></svg>',q,L,G='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(135deg)"><path d="m18 15-6-6-6 6"></path></svg>',W,te;return{c(){e=v("div"),t=v("button"),t.innerHTML=s,l=V(),i=v("button"),i.innerHTML=n,o=V(),a=v("button"),a.innerHTML=g,d=V(),f=v("button"),f.innerHTML=b,C=V(),y=v("button"),y.textContent=D,F=V(),E=v("button"),E.innerHTML=w,A=V(),M=v("button"),M.innerHTML=S,O=V(),k=v("button"),k.innerHTML=P,q=V(),L=v("button"),L.innerHTML=G,this.h()},l(ie){e=m(ie,"DIV",{class:!0,role:!0,"aria-label":!0});var T=x(e);t=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(t)!=="svelte-iknoph"&&(t.innerHTML=s),l=j(T),i=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(i)!=="svelte-1vym5xw"&&(i.innerHTML=n),o=j(T),a=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(a)!=="svelte-129hiuk"&&(a.innerHTML=g),d=j(T),f=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(f)!=="svelte-l1fib4"&&(f.innerHTML=b),C=j(T),y=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(y)!=="svelte-wpwm8s"&&(y.textContent=D),F=j(T),E=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(E)!=="svelte-1mhbnd1"&&(E.innerHTML=w),A=j(T),M=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(M)!=="svelte-15qq2ny"&&(M.innerHTML=S),O=j(T),k=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(k)!=="svelte-q0ox9v"&&(k.innerHTML=P),q=j(T),L=m(T,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(L)!=="svelte-1nlttuj"&&(L.innerHTML=G),T.forEach(p),this.h()},h(){u(t,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 rounded-tl-lg transition-colors"),u(t,"aria-label","Northwest"),u(i,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 transition-colors"),u(i,"aria-label","North"),u(a,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 rounded-tr-lg transition-colors"),u(a,"aria-label","Northeast"),u(f,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 transition-colors"),u(f,"aria-label","West"),u(y,"class","w-12 h-12 flex items-center justify-center bg-gray-700 hover:bg-gray-600 active:bg-blue-600 font-bold text-xs text-gray-300 transition-colors"),u(y,"aria-label","Look"),u(E,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 transition-colors"),u(E,"aria-label","East"),u(M,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 rounded-bl-lg transition-colors"),u(M,"aria-label","Southwest"),u(k,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 transition-colors"),u(k,"aria-label","South"),u(L,"class","w-12 h-12 flex items-center justify-center bg-gray-700/50 hover:bg-gray-600 active:bg-blue-600 rounded-br-lg transition-colors"),u(L,"aria-label","Southeast"),u(e,"class","grid grid-cols-3 gap-1 w-fit p-2 bg-gray-800 rounded-xl border border-gray-700 shadow-lg"),u(e,"role","group"),u(e,"aria-label","Movement Controls")},m(ie,T){ee(ie,e,T),c(e,t),c(e,l),c(e,i),c(e,o),c(e,a),c(e,d),c(e,f),c(e,C),c(e,y),c(e,F),c(e,E),c(e,A),c(e,M),c(e,O),c(e,k),c(e,q),c(e,L),W||(te=[$(t,"click",r[1]),$(i,"click",r[2]),$(a,"click",r[3]),$(f,"click",r[4]),$(y,"click",r[5]),$(E,"click",r[6]),$(M,"click",r[7]),$(k,"click",r[8]),$(L,"click",r[9])],W=!0)},p:le,i:le,o:le,d(ie){ie&&p(e),W=!1,De(te)}}}function ts(r){const e=Re();function t(b){Je.selection(),e("command",b)}return[t,()=>t("nw"),()=>t("north"),()=>t("ne"),()=>t("west"),()=>t("look"),()=>t("east"),()=>t("sw"),()=>t("south"),()=>t("se")]}class ss extends ye{constructor(e){super(),we(this,e,ts,es,_e,{})}}const Ne={player:"@",npc:"N",monster:"M",resource:"*",portal:"O",Ocean:"~",Rainforest:"T",DeciduousForest:"t",Taiga:"^",Grassland:".",Desert:":",Tundra:"_",Alpine:"A",default:"?"},Ae={player:"ðŸ§",npc:"ðŸ‘¤",monster:"âš”ï¸",resource:"ðŸ’Ž",portal:"ðŸŒ€",Ocean:"ðŸŒŠ",Rainforest:"ðŸŒ³",DeciduousForest:"ðŸŒ²",Taiga:"ðŸŒ²",Grassland:"ðŸŒ¿",Desert:"ðŸœï¸",Tundra:"â„ï¸",Alpine:"ðŸ—»",default:"Â·"};class ns{constructor(e){de(this,"canvas");de(this,"ctx");de(this,"tileSize",16);de(this,"quality","low");this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Could not get 2D context from canvas");this.ctx=t}setTileSize(e){this.tileSize=e}setQuality(e){this.quality=e}render(e,t){const s=this.canvas.width/2,l=this.canvas.height/2;this.ctx.fillStyle="#1a1a2e",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(const i of t){const n=s+(i.x-e.x)*this.tileSize,o=l+(i.y-e.y)*this.tileSize;this.renderTile(i,n,o)}this.renderPlayer(s,l)}renderTile(e,t,s){switch(this.quality){case"low":this.renderAsciiTile(e,t,s);break;case"medium":this.renderIconTile(e,t,s);break;case"high":this.renderEmojiTile(e,t,s);break}}renderAsciiTile(e,t,s){var n;this.ctx.fillStyle=this.getBiomeColor(e.biome,.3),this.ctx.fillRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize),this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.strokeRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize);let l=Ne[e.biome]||Ne.default,i="#888888";if((n=e.portal)!=null&&n.active&&(l=Ne.portal,i="#FF00FF"),e.entities&&e.entities.length>0){const o=e.entities[0];l=Ne[o.type]||"E",i=this.getEntityColor(o.type)}this.ctx.fillStyle=i,this.ctx.font=`bold ${this.tileSize*.7}px monospace`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(l,t,s)}renderIconTile(e,t,s){var i;this.ctx.fillStyle=this.getBiomeColor(e.biome,.6),this.ctx.fillRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize);const l=Math.max(0,Math.min(.2,e.elevation/5e3));if(this.ctx.fillStyle=`rgba(255, 255, 255, ${l})`,this.ctx.fillRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize),this.ctx.strokeStyle="rgba(255, 255, 255, 0.15)",this.ctx.strokeRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize),(i=e.portal)!=null&&i.active&&(this.ctx.fillStyle="#FF00FF",this.ctx.beginPath(),this.ctx.arc(t,s,this.tileSize/3,0,Math.PI*2),this.ctx.fill()),e.entities&&e.entities.length>0){const n=e.entities[0];this.ctx.fillStyle=this.getEntityColor(n.type),this.ctx.beginPath(),this.ctx.arc(t,s,this.tileSize/4,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1,this.ctx.stroke()}}renderEmojiTile(e,t,s){var i;this.ctx.fillStyle=this.getBiomeColor(e.biome,.8),this.ctx.fillRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize),this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.strokeRect(t-this.tileSize/2,s-this.tileSize/2,this.tileSize,this.tileSize);let l=Ae[e.biome]||Ae.default;if((i=e.portal)!=null&&i.active&&(l=Ae.portal),e.entities&&e.entities.length>0){const n=e.entities[0];l=Ae[n.type]||"ðŸ‘¤"}this.ctx.font=`${this.tileSize*.7}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(l,t,s)}renderPlayer(e,t){this.quality==="low"?(this.ctx.fillStyle="#FFD700",this.ctx.font=`bold ${this.tileSize*.8}px monospace`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("@",e,t)):this.quality==="high"?(this.ctx.fillStyle="rgba(255, 215, 0, 0.3)",this.ctx.fillRect(e-this.tileSize/2,t-this.tileSize/2,this.tileSize,this.tileSize),this.ctx.font=`${this.tileSize*.7}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("ðŸ§",e,t)):(this.ctx.fillStyle="#FFD700",this.ctx.beginPath(),this.ctx.arc(e,t,this.tileSize/3,0,Math.PI*2),this.ctx.fill(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.stroke()),this.ctx.strokeStyle="#FFD700",this.ctx.lineWidth=2,this.ctx.strokeRect(e-this.tileSize/2+1,t-this.tileSize/2+1,this.tileSize-2,this.tileSize-2)}getBiomeColor(e,t=1){return{Ocean:`rgba(70, 130, 180, ${t})`,Rainforest:`rgba(34, 139, 34, ${t})`,DeciduousForest:`rgba(60, 120, 60, ${t})`,Taiga:`rgba(50, 80, 60, ${t})`,Grassland:`rgba(144, 238, 144, ${t})`,Desert:`rgba(244, 164, 96, ${t})`,Tundra:`rgba(224, 255, 255, ${t})`,Alpine:`rgba(128, 128, 128, ${t})`,ocean:`rgba(70, 130, 180, ${t})`,rainforest:`rgba(34, 139, 34, ${t})`,forest:`rgba(34, 139, 34, ${t})`,grassland:`rgba(144, 238, 144, ${t})`,desert:`rgba(244, 164, 96, ${t})`,tundra:`rgba(224, 255, 255, ${t})`,mountain:`rgba(128, 128, 128, ${t})`,swamp:`rgba(85, 107, 47, ${t})`}[e]||`rgba(51, 51, 51, ${t})`}getEntityColor(e){return{npc:"#FFFF00",player:"#00FFFF",resource:"#FFA500",monster:"#FF0000",item:"#FFA500"}[e]||"#FFFFFF"}}function rs(r){var d;let e,t,s,l,i="N",n,o,a=dt((d=r[0].data)==null?void 0:d.render_quality)+"",g;return{c(){e=v("div"),t=v("canvas"),s=V(),l=v("div"),l.textContent=i,n=V(),o=v("div"),g=X(a),this.h()},l(f){e=m(f,"DIV",{class:!0,"data-testid":!0});var b=x(e);t=m(b,"CANVAS",{width:!0,height:!0,class:!0}),x(t).forEach(p),s=j(b),l=m(b,"DIV",{class:!0,"data-svelte-h":!0}),J(l)!=="svelte-27zddx"&&(l.textContent=i),n=j(b),o=m(b,"DIV",{class:!0,title:!0});var C=x(o);g=Q(C,a),C.forEach(p),b.forEach(p),this.h()},h(){u(t,"width",Qe),u(t,"height",Qe),u(t,"class","map-canvas svelte-ctrdyw"),u(l,"class","compass svelte-ctrdyw"),u(o,"class","quality-indicator svelte-ctrdyw"),u(o,"title","Perception Quality"),u(e,"class","mini-map-container svelte-ctrdyw"),u(e,"data-testid","mini-map")},m(f,b){ee(f,e,b),c(e,t),r[3](t),c(e,s),c(e,l),c(e,n),c(e,o),c(o,g)},p(f,[b]){var C;b&1&&a!==(a=dt((C=f[0].data)==null?void 0:C.render_quality)+"")&&ne(g,a)},i:le,o:le,d(f){f&&p(e),r[3](null)}}}const Qe=152;function dt(r){switch(r){case"high":return"â—†â—†â—†";case"medium":return"â—†â—†â—‹";default:return"â—†â—‹â—‹"}}function is(r,e,t){let s;It(r,kt,g=>t(0,s=g));const l=Math.floor(Qe/9);let i,n=null;xt(()=>{i&&(t(2,n=new ns(i)),n.setTileSize(l),s.data&&(n.setQuality(s.data.render_quality||"low"),o()))});function o(){if(!n||!s.data)return;const g={x:Math.round(s.data.player_x),y:Math.round(s.data.player_y)},d=s.data.tiles.map(f=>({x:f.x,y:f.y,biome:f.biome||"",elevation:f.elevation||0,entities:f.entities||[],is_player:f.is_player,portal:f.portal}));n.render(g,d)}function a(g){Tt[g?"unshift":"push"](()=>{i=g,t(1,i)})}return r.$$.update=()=>{r.$$.dirty&5&&n&&s.data&&(n.setQuality(s.data.render_quality||"low"),o())},[s,i,n,a]}class ls extends ye{constructor(e){super(),we(this,e,is,rs,_e,{})}}function ut(r,e,t){const s=r.slice();return s[5]=e[t],s}function ht(r){let e,t=r[5].label+"",s,l,i,n,o;function a(){return r[3](r[5])}return{c(){e=v("button"),s=X(t),l=V(),this.h()},l(g){e=m(g,"BUTTON",{class:!0,"aria-label":!0});var d=x(e);s=Q(d,t),l=j(d),d.forEach(p),this.h()},h(){u(e,"class","min-w-[44px] min-h-[44px] px-4 py-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 text-gray-300 rounded-lg transition-colors text-sm font-medium"),u(e,"aria-label",i=r[5].label)},m(g,d){ee(g,e,d),c(e,s),c(e,l),n||(o=$(e,"click",a),n=!0)},p(g,d){r=g,d&1&&t!==(t=r[5].label+"")&&ne(s,t),d&1&&i!==(i=r[5].label)&&u(e,"aria-label",i)},d(g){g&&p(e),n=!1,o()}}}function os(r){let e,t,s,l,i,n,o,a,g;s=new ls({});let d=ve(r[0]),f=[];for(let b=0;b<d.length;b+=1)f[b]=ht(ut(r,d,b));return a=new ss({}),a.$on("command",r[2]),{c(){e=v("div"),t=v("div"),Te(s.$$.fragment),l=V(),i=v("div");for(let b=0;b<f.length;b+=1)f[b].c();n=V(),o=v("div"),Te(a.$$.fragment),this.h()},l(b){e=m(b,"DIV",{class:!0});var C=x(e);t=m(C,"DIV",{class:!0});var y=x(t);Ie(s.$$.fragment,y),y.forEach(p),l=j(C),i=m(C,"DIV",{class:!0});var D=x(i);for(let E=0;E<f.length;E+=1)f[E].l(D);D.forEach(p),n=j(C),o=m(C,"DIV",{class:!0});var F=x(o);Ie(a.$$.fragment,F),F.forEach(p),C.forEach(p),this.h()},h(){u(t,"class","flex-shrink-0"),u(i,"class","flex flex-wrap gap-2 flex-1 justify-center"),u(o,"class","flex-shrink-0"),u(e,"class","flex flex-row gap-4 w-full items-end justify-between")},m(b,C){ee(b,e,C),c(e,t),Ee(s,t,null),c(e,l),c(e,i);for(let y=0;y<f.length;y+=1)f[y]&&f[y].m(i,null);c(e,n),c(e,o),Ee(a,o,null),g=!0},p(b,[C]){if(C&3){d=ve(b[0]);let y;for(y=0;y<d.length;y+=1){const D=ut(b,d,y);f[y]?f[y].p(D,C):(f[y]=ht(D),f[y].c(),f[y].m(i,null))}for(;y<f.length;y+=1)f[y].d(1);f.length=d.length}},i(b){g||(ce(s.$$.fragment,b),ce(a.$$.fragment,b),g=!0)},o(b){fe(s.$$.fragment,b),fe(a.$$.fragment,b),g=!1},d(b){b&&p(e),Se(s),He(f,b),Se(a)}}}function as(r,e,t){const s=Re();let{commands:l=[{label:"Inventory",command:"inventory"},{label:"Help",command:"help"}]}=e;function i(a){Je.selection(),s("submit",a)}function n(a){i(a.detail)}const o=a=>i(a.command);return r.$$set=a=>{"commands"in a&&t(0,l=a.commands)},[l,i,n,o]}class cs extends ye{constructor(e){super(),we(this,e,as,os,_e,{commands:0})}}function ft(r,e,t){const s=r.slice();return s[40]=e[t],s}function gt(r,e,t){const s=r.slice();return s[40]=e[t],s}function mt(r){let e,t="Character",s,l;return{c(){e=v("button"),e.textContent=t,this.h()},l(i){e=m(i,"BUTTON",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-lsufuc"&&(e.textContent=t),this.h()},h(){u(e,"class","bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-sm transition-colors")},m(i,n){ee(i,e,n),s||(l=$(e,"click",r[13]),s=!0)},p:le,d(i){i&&p(e),s=!1,l()}}}function ds(r){let e,t=[],s=new Map,l=ve(r[5]);const i=n=>n[40].id;for(let n=0;n<l.length;n+=1){let o=ft(r,l,n),a=i(o);s.set(a,t[n]=vt(a,o))}return{c(){e=v("div");for(let n=0;n<t.length;n+=1)t[n].c();this.h()},l(n){e=m(n,"DIV",{class:!0,id:!0,"data-testid":!0});var o=x(e);for(let a=0;a<t.length;a+=1)t[a].l(o);o.forEach(p),this.h()},h(){u(e,"class","flex-1 overflow-y-auto p-4 space-y-2 scroll-smooth"),u(e,"id","game-output"),u(e,"data-testid","game-output")},m(n,o){ee(n,e,o);for(let a=0;a<t.length;a+=1)t[a]&&t[a].m(e,null)},p(n,o){o[0]&32&&(l=ve(n[5]),t=qt(t,o,i,1,n,l,s,e,zt,vt,null,ft))},d(n){n&&p(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function us(r){let e,t,s=ve(r[2]),l=[];for(let n=0;n<s.length;n+=1)l[n]=bt(gt(r,s,n));let i=r[1]&&pt(r);return{c(){e=v("div");for(let n=0;n<l.length;n+=1)l[n].c();t=V(),i&&i.c(),this.h()},l(n){e=m(n,"DIV",{class:!0,id:!0,"data-testid":!0});var o=x(e);for(let a=0;a<l.length;a+=1)l[a].l(o);t=j(o),i&&i.l(o),o.forEach(p),this.h()},h(){u(e,"class","flex-1 flex flex-col p-4 overflow-y-auto"),u(e,"id","game-output"),u(e,"data-testid","game-output")},m(n,o){ee(n,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null);c(e,t),i&&i.m(e,null)},p(n,o){if(o[0]&4){s=ve(n[2]);let a;for(a=0;a<s.length;a+=1){const g=gt(n,s,a);l[a]?l[a].p(g,o):(l[a]=bt(g),l[a].c(),l[a].m(e,t))}for(;a<l.length;a+=1)l[a].d(1);l.length=s.length}n[1]?i?i.p(n,o):(i=pt(n),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(n){n&&p(e),He(l,n),i&&i.d()}}}function hs(r){let e,t='<div class="text-xl text-gray-400 animate-pulse">Loading...</div>';return{c(){e=v("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1nxqtd8"&&(e.innerHTML=t),this.h()},h(){u(e,"class","flex-1 flex items-center justify-center")},m(s,l){ee(s,e,l)},p:le,d(s){s&&p(e)}}}function vt(r,e){let t,s,l=e[40].text.replace(/\n/g,"<br>")+"",i,n;return{key:r,first:null,c(){t=v("div"),s=new Pt(!1),i=V(),this.h()},l(o){t=m(o,"DIV",{class:!0});var a=x(t);s=Mt(a,!1),i=j(a),a.forEach(p),this.h()},h(){s.a=i,u(t,"class",n=be(`message leading-relaxed ${e[40].type==="error"?"text-red-400":e[40].type==="system"?"text-yellow-400":e[40].type==="player"?"text-blue-300":e[40].type==="emote"?"text-orange-300 italic":"text-gray-300"}`)+" svelte-lcmnji"),this.first=t},m(o,a){ee(o,t,a),s.m(l,t),c(t,i)},p(o,a){e=o,a[0]&32&&l!==(l=e[40].text.replace(/\n/g,"<br>")+"")&&s.p(l),a[0]&32&&n!==(n=be(`message leading-relaxed ${e[40].type==="error"?"text-red-400":e[40].type==="system"?"text-yellow-400":e[40].type==="player"?"text-blue-300":e[40].type==="emote"?"text-orange-300 italic":"text-gray-300"}`)+" svelte-lcmnji")&&u(t,"class",n)},d(o){o&&p(t)}}}function bt(r){let e,t,s=r[40].text+"",l,i,n;return{c(){e=v("div"),t=v("div"),l=X(s),this.h()},l(o){e=m(o,"DIV",{class:!0});var a=x(e);t=m(a,"DIV",{class:!0});var g=x(t);l=Q(g,s),g.forEach(p),a.forEach(p),this.h()},h(){u(t,"class",i=be(`inline-block p-3 rounded-lg max-w-[80%] ${r[40].role==="user"?"bg-blue-900/50 text-blue-100":"bg-gray-800/50 text-gray-100"}`)+" svelte-lcmnji"),u(e,"class",n=be(`mb-4 ${r[40].role==="user"?"text-right":"text-left"}`)+" svelte-lcmnji")},m(o,a){ee(o,e,a),c(e,t),c(t,l)},p(o,a){a[0]&4&&s!==(s=o[40].text+"")&&ne(l,s),a[0]&4&&i!==(i=be(`inline-block p-3 rounded-lg max-w-[80%] ${o[40].role==="user"?"bg-blue-900/50 text-blue-100":"bg-gray-800/50 text-gray-100"}`)+" svelte-lcmnji")&&u(t,"class",i),a[0]&4&&n!==(n=be(`mb-4 ${o[40].role==="user"?"text-right":"text-left"}`)+" svelte-lcmnji")&&u(e,"class",n)},d(o){o&&p(e)}}}function pt(r){let e,t,s;return{c(){e=v("div"),t=v("div"),s=X(r[1]),this.h()},l(l){e=m(l,"DIV",{class:!0});var i=x(e);t=m(i,"DIV",{class:!0});var n=x(t);s=Q(n,r[1]),n.forEach(p),i.forEach(p),this.h()},h(){u(t,"class","inline-block p-3 rounded-lg max-w-[80%] bg-gray-800/50 text-gray-100 border-l-4 border-blue-500"),u(e,"class","mb-4 text-left")},m(l,i){ee(l,e,i),c(e,t),c(t,s)},p(l,i){i[0]&2&&ne(s,l[1])},d(l){l&&p(e)}}}function _t(r){let e,t;return e=new cs({}),e.$on("submit",r[16]),{c(){Te(e.$$.fragment)},l(s){Ie(e.$$.fragment,s)},m(s,l){Ee(e,s,l),t=!0},p:le,i(s){t||(ce(e.$$.fragment,s),t=!0)},o(s){fe(e.$$.fragment,s),t=!1},d(s){Se(e,s)}}}function fs(r){let e,t;return e=new $t({}),e.$on("submit",r[19]),{c(){Te(e.$$.fragment)},l(s){Ie(e.$$.fragment,s)},m(s,l){Ee(e,s,l),t=!0},p:le,i(s){t||(ce(e.$$.fragment,s),t=!0)},o(s){fe(e.$$.fragment,s),t=!1},d(s){Se(e,s)}}}function gs(r){let e,t,s,l;return{c(){e=v("div"),t=v("input"),this.h()},l(i){e=m(i,"DIV",{class:!0});var n=x(e);t=m(n,"INPUT",{type:!0,placeholder:!0,class:!0,style:!0}),n.forEach(p),this.h()},h(){u(t,"type","text"),u(t,"placeholder","Answer the question..."),u(t,"class","w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-gray-100 text-base focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all"),Oe(t,"font-size","16px"),u(e,"class","relative")},m(i,n){ee(i,e,n),c(e,t),Be(t,r[6]),s||(l=[$(t,"input",r[17]),$(t,"keydown",r[18])],s=!0)},p(i,n){n[0]&64&&t.value!==i[6]&&Be(t,i[6])},i:le,o:le,d(i){i&&p(e),s=!1,De(l)}}}function yt(r){let e,t;return e=new Wt({props:{options:r[4]}}),e.$on("select",r[12]),{c(){Te(e.$$.fragment)},l(s){Ie(e.$$.fragment,s)},m(s,l){Ee(e,s,l),t=!0},p(s,l){const i={};l[0]&16&&(i.options=s[4]),e.$set(i)},i(s){t||(ce(e.$$.fragment,s),t=!0)},o(s){fe(e.$$.fragment,s),t=!1},d(s){Se(e,s)}}}function wt(r){let e,t,s,l="âœ•",i,n,o,a,g;return n=new Yt({props:{characterName:r[10].name,level:r[10].level,experience:r[10].experience,nextLevelXP:r[10].nextLevelXP,strength:r[10].attributes.strength,dexterity:r[10].attributes.dexterity,constitution:r[10].attributes.constitution,intelligence:r[10].attributes.intelligence,wisdom:r[10].attributes.wisdom,charisma:r[10].attributes.charisma,skills:r[9]}}),{c(){e=v("div"),t=v("div"),s=v("button"),s.textContent=l,i=V(),Te(n.$$.fragment),this.h()},l(d){e=m(d,"DIV",{class:!0});var f=x(e);t=m(f,"DIV",{class:!0});var b=x(t);s=m(b,"BUTTON",{class:!0,"data-testid":!0,"data-svelte-h":!0}),J(s)!=="svelte-y4cdky"&&(s.textContent=l),i=j(b),Ie(n.$$.fragment,b),b.forEach(p),f.forEach(p),this.h()},h(){u(s,"class","absolute -top-2 -right-2 bg-gray-700 rounded-full w-8 h-8 flex items-center justify-center text-white hover:bg-gray-600 z-10"),u(s,"data-testid","close-character-sheet"),u(t,"class","relative max-w-md w-full"),u(e,"class","absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50 transition-opacity")},m(d,f){ee(d,e,f),c(e,t),c(t,s),c(t,i),Ee(n,t,null),o=!0,a||(g=[$(s,"click",r[20]),$(t,"click",Vt(r[14])),$(e,"click",r[21])],a=!0)},p(d,f){const b={};f[0]&512&&(b.skills=d[9]),n.$set(b)},i(d){o||(ce(n.$$.fragment,d),o=!0)},o(d){fe(n.$$.fragment,d),o=!1},d(d){d&&p(e),Se(n),a=!1,De(g)}}}function ms(r){let e,t,s,l="Thousand Worlds",i,n,o,a,g,d,f,b=r[7]?"Connected":"Reconnecting...",C,y,D,F,E,w,A="Logout",M,S,O,k,P,q,L,G,W,te,ie,T,Y=r[0]==="game"&&mt(r);function ge(h,I){return h[0]==="checking"?hs:h[0]==="interview"?us:ds}let ae=ge(r),B=ae(r),N=r[0]!=="interview"&&r[0]!=="checking"&&_t(r);const Z=[gs,fs],R=[];function he(h,I){return h[0]==="interview"?0:h[0]!=="checking"?1:-1}~(q=he(r))&&(L=R[q]=Z[q](r));let K=r[3]&&r[4]&&yt(r),_=r[8]&&wt(r);return{c(){e=v("div"),t=v("header"),s=v("h1"),s.textContent=l,i=V(),n=v("div"),o=v("div"),a=v("div"),d=V(),f=v("span"),C=X(b),F=V(),Y&&Y.c(),E=V(),w=v("button"),w.textContent=A,M=V(),S=v("main"),B.c(),O=V(),k=v("div"),N&&N.c(),P=V(),L&&L.c(),G=V(),K&&K.c(),W=V(),_&&_.c(),this.h()},l(h){e=m(h,"DIV",{class:!0});var I=x(e);t=m(I,"HEADER",{class:!0});var z=x(t);s=m(z,"H1",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-1p9gpg2"&&(s.textContent=l),i=j(z),n=m(z,"DIV",{class:!0});var H=x(n);o=m(H,"DIV",{class:!0,title:!0});var se=x(o);a=m(se,"DIV",{class:!0}),x(a).forEach(p),d=j(se),f=m(se,"SPAN",{class:!0});var re=x(f);C=Q(re,b),re.forEach(p),se.forEach(p),F=j(H),Y&&Y.l(H),E=j(H),w=m(H,"BUTTON",{class:!0,"data-svelte-h":!0}),J(w)!=="svelte-fhceqg"&&(w.textContent=A),H.forEach(p),z.forEach(p),M=j(I),S=m(I,"MAIN",{class:!0});var U=x(S);B.l(U),O=j(U),k=m(U,"DIV",{class:!0});var oe=x(k);N&&N.l(oe),P=j(oe),L&&L.l(oe),oe.forEach(p),G=j(U),K&&K.l(U),W=j(U),_&&_.l(U),U.forEach(p),I.forEach(p),this.h()},h(){u(s,"class","text-xl font-bold text-blue-400"),u(a,"class",g=be(`w-3 h-3 rounded-full ${r[7]?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)] connected":"bg-red-500 animate-pulse"}`)+" svelte-lcmnji"),u(f,"class",y=r[7]?"text-gray-400":"text-red-400"),u(o,"class","flex items-center gap-2 text-sm"),u(o,"title",D=r[7]?"Connected":"Disconnected"),u(w,"class","text-sm text-gray-400 hover:text-white transition-colors"),u(n,"class","flex items-center gap-4"),u(t,"class","bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center"),u(k,"class","p-4 bg-gray-800 border-t border-gray-700 space-y-3"),u(S,"class","flex-1 overflow-hidden flex flex-col relative"),u(e,"class","flex flex-col h-screen bg-gray-900 text-gray-100 font-mono")},m(h,I){ee(h,e,I),c(e,t),c(t,s),c(t,i),c(t,n),c(n,o),c(o,a),c(o,d),c(o,f),c(f,C),c(n,F),Y&&Y.m(n,null),c(n,E),c(n,w),c(e,M),c(e,S),B.m(S,null),c(S,O),c(S,k),N&&N.m(k,null),c(k,P),~q&&R[q].m(k,null),c(S,G),K&&K.m(S,null),c(S,W),_&&_.m(S,null),te=!0,ie||(T=$(w,"click",r[15]),ie=!0)},p(h,I){(!te||I[0]&128&&g!==(g=be(`w-3 h-3 rounded-full ${h[7]?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)] connected":"bg-red-500 animate-pulse"}`)+" svelte-lcmnji"))&&u(a,"class",g),(!te||I[0]&128)&&b!==(b=h[7]?"Connected":"Reconnecting...")&&ne(C,b),(!te||I[0]&128&&y!==(y=h[7]?"text-gray-400":"text-red-400"))&&u(f,"class",y),(!te||I[0]&128&&D!==(D=h[7]?"Connected":"Disconnected"))&&u(o,"title",D),h[0]==="game"?Y?Y.p(h,I):(Y=mt(h),Y.c(),Y.m(n,E)):Y&&(Y.d(1),Y=null),ae===(ae=ge(h))&&B?B.p(h,I):(B.d(1),B=ae(h),B&&(B.c(),B.m(S,O))),h[0]!=="interview"&&h[0]!=="checking"?N?(N.p(h,I),I[0]&1&&ce(N,1)):(N=_t(h),N.c(),ce(N,1),N.m(k,P)):N&&(qe(),fe(N,1,1,()=>{N=null}),ze());let z=q;q=he(h),q===z?~q&&R[q].p(h,I):(L&&(qe(),fe(R[z],1,1,()=>{R[z]=null}),ze()),~q?(L=R[q],L?L.p(h,I):(L=R[q]=Z[q](h),L.c()),ce(L,1),L.m(k,null)):L=null),h[3]&&h[4]?K?(K.p(h,I),I[0]&24&&ce(K,1)):(K=yt(h),K.c(),ce(K,1),K.m(S,W)):K&&(qe(),fe(K,1,1,()=>{K=null}),ze()),h[8]?_?(_.p(h,I),I[0]&256&&ce(_,1)):(_=wt(h),_.c(),ce(_,1),_.m(S,null)):_&&(qe(),fe(_,1,1,()=>{_=null}),ze())},i(h){te||(ce(N),ce(L),ce(K),ce(_),te=!0)},o(h){fe(N),fe(L),fe(K),fe(_),te=!1},d(h){h&&p(e),Y&&Y.d(),B.d(),N&&N.d(),~q&&R[q].d(),K&&K.d(),_&&_.d(),ie=!1,T()}}}const Ce="/api";function vs(r,e,t){let s="checking",l=null,i="",n="",o=[],a=!1,g=null,d=null,f=[],b="",C=null,y=!1,D=null,F=!1,E={},w={name:"Adventurer",level:1,experience:0,nextLevelXP:100,attributes:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10}},A=null;xt(async()=>{try{A=await Le.getMe()}catch{et("/");return}const _=pe.connected.subscribe(I=>{t(7,y=I)});C=pe.onMessage(ie);const h=C;C=()=>{h&&h(),_()},await M()}),Dt(()=>{C&&C()});async function M(){try{const _=await fetch(`${Ce}/world/interview/active`,{credentials:"include"});if(_.ok){const h=await _.json();if(h&&h.status==="in_progress"){if(t(0,s="interview"),l=h.session_id,h.question==="The interview is already complete."||h.question==="This interview is already complete."){T("system","World interview previously completed."),setTimeout(()=>{S()},1e3);return}if(t(2,o=h.conversation||[]),o.length>0){const I=o[o.length-1];I.role==="assistant"&&t(1,i=I.text)}else h.question&&(t(1,i=h.question),T("interview",i));T("system","Resuming your world creation interview...");return}}if(A!=null&&A.last_world_id)try{const h=await Le.getCharacters();if(h&&h.characters){const I=h.characters.find(z=>z.world_id===(A==null?void 0:A.last_world_id));if(I){await W(I.character_id);return}}}catch(h){console.error("Auto-resume check failed",h)}await S()}catch(_){console.error("Onboarding check failed:",_),t(0,s="game"),T("error","Failed to check status. Starting in game mode."),S()}}async function S(){console.log("[Lobby] Joining lobby...");try{console.log("[Lobby] Disconnecting existing WebSocket..."),pe.disconnect(),await new Promise(_=>setTimeout(_,100)),console.log("[Lobby] Connecting to WebSocket..."),pe.connect(),t(0,s="lobby"),console.log("[Lobby] Lobby join complete")}catch(_){console.error("[Lobby] Failed to join lobby:",_),T("error","Failed to join lobby.")}}async function O(){try{const _=await fetch(`${Ce}/world/interview/start`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!_.ok){const I=await _.text();throw console.error("Interview start failed:",_.status,I),new Error(`Failed to start interview: ${_.status}`)}const h=await _.json();if(console.log("Interview started:",h),!h.session_id||!h.question)throw console.error("Invalid interview response:",h),new Error("Invalid response from server");l=h.session_id,t(1,i=h.question||"Tell me about the world you'd like to create."),o.push({role:"assistant",text:i}),T("interview",i),t(0,s="interview")}catch(_){console.error("Failed to start interview:",_),T("error",_.message||"Failed to start world interview. Please try again.")}}async function k(){if(!n.trim()||!l)return;const _=n.trim();o.push({role:"user",text:_}),T("user",_),n="";try{T("system","Thinking... (this may take 10-20 seconds)");const h=new AbortController,I=setTimeout(()=>h.abort(),6e4),z=await fetch(`${Ce}/world/interview/message`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({session_id:l,message:_}),signal:h.signal});if(clearTimeout(I),!z.ok){const se=await z.text();throw console.error("Interview message failed:",z.status,se),new Error(`Failed to send message: ${z.status}`)}const H=await z.json();if(console.log("Interview response:",H),H.completed||H.question==="The interview is already complete."||H.question==="This interview is already complete.")T("system","World interview complete! Creating your world..."),H.question&&!H.question.includes("already complete")&&(o.push({role:"assistant",text:H.question}),T("interview",H.question)),setTimeout(()=>{S(),T("system","World created! Use 'worlds' to see it.")},2e3);else{const se=H.next_question||H.question||H.response||"Please continue...";t(1,i=se),o.push({role:"assistant",text:se}),T("interview",se)}}catch(h){console.error("Failed to send response:",h),T("error",h.message||"Failed to process your response. Please try again.")}}async function P(_){const h=_?_.trim():b.trim();if(h){if(T("player",`> ${h}`),s==="interview"){n=h,t(6,b=""),k();return}if(h.toLowerCase().startsWith("create character")){await te(h),_||t(6,b="");return}if(h.trim().toLowerCase()==="status"){Y(),_||t(6,b="");return}pe.sendCommandWithQueue(h),_||t(6,b="")}}async function q(_){try{T("system",`Checking entry options for world ${_}...`);const h=await fetch(`${Ce}/game/entry-options?world_id=${_}`,{credentials:"include"});if(h.ok){const I=await h.json();t(4,g=I),d=_,t(3,a=!0)}else{const I=await h.text();T("error",`Cannot enter world: ${I}`)}}catch{T("error","Failed to get entry options.")}}async function L(_){const{type:h,data:I}=_.detail;if(d){t(3,a=!1);try{if(h==="cancel"){d=null;return}if(h==="watcher"){await G("Watcher","Spirit",d,"An invisible observer.","Watcher","watcher");return}if(h==="npc"){const z=I;await G(z.name,z.species,d,z.description,z.occupation,"player",z.appearance)}h==="custom"&&(t(0,s="character"),T("system","Enter: create character <name> <species>"))}catch(z){console.error(z),T("error","Entry failed.")}}}async function G(_,h,I,z,H,se,re){try{const U=await fetch(`${Ce}/game/characters`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({world_id:I,name:_,species:h,role:se,description:z,occupation:H,appearance:re})});if(!U.ok){const me=await U.json();let xe="Failed to create character";throw typeof me.error=="string"?xe=me.error:me.error&&me.error.message&&(xe=me.error.message),new Error(xe)}const oe=await U.json();T("system",`Character "${_}" created! Joining world...`),await W(oe.character.character_id)}catch(U){T("error",U.message)}}async function W(_){try{const h=await fetch(`${Ce}/game/join`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({character_id:_})});if(!h.ok){const z=await h.json();throw console.error("Failed to join game:",z),new Error("Failed to join game session.")}const I=await h.json();pe.disconnect(),pe.connect(_),D=_,t(0,s="game"),I.message?T("system",I.message):T("system","You have entered the world!")}catch(h){throw h}}async function te(_){const h=_.toLowerCase().split(" ");if(h[0]==="create"&&h[1]==="character"&&h.length>=4){const I=h[2],z=h[3].charAt(0).toUpperCase()+h[3].slice(1);await G(I,z,d||"00000000-0000-0000-0000-000000000001")}else T("error","Invalid command. Use: create character <name> <species>")}function ie(_){var h;switch(_.type){case"game_message":const I=_.data.type;if(I==="trigger_entry_options"){const z=((h=_.data.metadata)==null?void 0:h.world_id)||_.data.text;q(z)}else I==="start_interview"?O():T(I,_.data.text);break;case"error":T("error",_.data.message);break}}async function T(_,h){let I=!1;const z=document.getElementById("game-output");if(z){const{scrollTop:H,scrollHeight:se,clientHeight:re}=z;se-H-re<100&&(I=!0)}else I=!0;t(5,f=[...f,{id:Date.now().toString()+Math.random(),type:_,text:h,timestamp:new Date}]),await jt(),I&&z&&(z.scrollTop=z.scrollHeight)}async function Y(){if(!D){T("error","No active character.");return}try{const _=await Le.getSkills(D);t(9,E=_.skills||{}),t(8,F=!0)}catch(_){console.error(_),T("error","Failed to load skills.")}}function ge(_){Ft.call(this,r,_)}const ae=()=>{Le.logout(),et("/")},B=_=>P(_.detail);function N(){b=this.value,t(6,b)}return[s,i,o,a,g,f,b,y,F,E,w,P,L,Y,ge,ae,B,N,_=>_.key==="Enter"&&P(),_=>P(_.detail),()=>t(8,F=!1),()=>t(8,F=!1)]}class ks extends ye{constructor(e){super(),we(this,e,vs,ms,_e,{},null,[-1,-1])}}export{ks as component};
