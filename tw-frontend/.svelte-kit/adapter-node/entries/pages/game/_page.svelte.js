import { c as create_ssr_component, a as subscribe, o as onDestroy, e as escape, b as add_attribute, d as each, v as validate_component, n as null_to_empty } from "../../../chunks/ssr.js";
import "@sveltejs/kit/internal";
import "../../../chunks/exports.js";
import "../../../chunks/utils.js";
import "@sveltejs/kit/internal/server";
import "../../../chunks/state.svelte.js";
import { m as mapStore } from "../../../chunks/game.js";
import { w as writable } from "../../../chunks/index.js";
const hexToRgb = (hex) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : { r: 0, g: 0, b: 0 };
};
({
  // Biomes
  Ocean: hexToRgb("#4682B4"),
  Rainforest: hexToRgb("#228B22"),
  DeciduousForest: hexToRgb("#3C783C"),
  Taiga: hexToRgb("#32503C"),
  Grassland: hexToRgb("#90EE90"),
  Desert: hexToRgb("#F4A460"),
  Tundra: hexToRgb("#E0FFFF"),
  Alpine: hexToRgb("#808080"),
  // Special
  Lobby: hexToRgb("#505064"),
  Void: hexToRgb("#14141E"),
  Default: hexToRgb("#333333")
});
[
  { el: -4e3, color: hexToRgb("#0a1929") },
  // Abyssal
  { el: -2e3, color: hexToRgb("#0d3a5c") },
  { el: -200, color: hexToRgb("#1565c0") },
  { el: 0, color: hexToRgb("#4fc3f7") },
  // Shallow
  { el: 200, color: hexToRgb("#66bb6a") },
  // Lowland
  { el: 500, color: hexToRgb("#aed581") },
  { el: 1500, color: hexToRgb("#dce775") },
  { el: 3e3, color: hexToRgb("#a1887f") },
  // Highland
  { el: 5e3, color: hexToRgb("#9e9e9e") },
  // Mountain
  { el: 8e3, color: hexToRgb("#fafafa") }
  // Peak
];
const WorldMapModal = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let $$unsubscribe_mapStore;
  $$unsubscribe_mapStore = subscribe(mapStore, (value) => value);
  let { isOpen = false } = $$props;
  let { onClose } = $$props;
  let canvas;
  let containerWidth = 0;
  let containerHeight = 0;
  let simStats = {
    year: 0,
    events: []
  };
  onDestroy(() => {
  });
  if ($$props.isOpen === void 0 && $$bindings.isOpen && isOpen !== void 0) $$bindings.isOpen(isOpen);
  if ($$props.onClose === void 0 && $$bindings.onClose && onClose !== void 0) $$bindings.onClose(onClose);
  $$unsubscribe_mapStore();
  return `${isOpen ? `<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm"><div class="bg-gray-900 border border-gray-700 rounded-lg shadow-2xl w-[90vw] h-[90vh] flex flex-col overflow-hidden"> <div class="flex justify-between items-center p-4 border-b border-gray-800 bg-gray-800/50"><h2 class="text-xl font-bold text-blue-400" data-svelte-h="svelte-1kpv5fi">World Map &amp; Simulation</h2> <div class="flex gap-4"><div class="text-sm text-gray-400">Year: <span class="text-white font-mono">${escape(simStats.year)}</span></div> <button class="text-gray-400 hover:text-white transition-colors" data-svelte-h="svelte-lulo1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div>  <div class="flex-1 flex overflow-hidden"> <div class="flex-1 bg-black relative"><canvas${add_attribute("width", containerWidth, 0)}${add_attribute("height", containerHeight, 0)} class="block w-full h-full"${add_attribute("this", canvas, 0)}></canvas>  <div class="absolute bottom-4 right-4 flex gap-2" data-svelte-h="svelte-1ha78jc"><div class="bg-gray-800/80 p-2 rounded text-xs text-gray-300">WASD to Pan • Scroll to Zoom</div></div></div>  <div class="w-80 bg-gray-850 border-l border-gray-800 flex flex-col"><div class="p-4 border-b border-gray-800" data-svelte-h="svelte-63h2bi"><h3 class="font-bold text-gray-300 mb-2">Ecosystem Stats</h3> <div class="grid grid-cols-2 gap-2 text-sm"><div class="bg-gray-800 p-2 rounded"><div class="text-gray-500 text-xs">Population</div> <div class="text-green-400 font-mono">--</div></div> <div class="bg-gray-800 p-2 rounded"><div class="text-gray-500 text-xs">Species</div> <div class="text-yellow-400 font-mono">--</div></div> <div class="bg-gray-800 p-2 rounded"><div class="text-gray-500 text-xs">Temperature</div> <div class="text-red-400 font-mono">--°C</div></div> <div class="bg-gray-800 p-2 rounded"><div class="text-gray-500 text-xs">CO2</div> <div class="text-blue-400 font-mono">-- ppm</div></div></div></div> <div class="flex-1 flex flex-col overflow-hidden"><h3 class="font-bold text-gray-300 p-4 pb-2" data-svelte-h="svelte-10tq5ud">Event Log</h3> <div class="flex-1 overflow-y-auto p-4 pt-0 space-y-2 font-mono text-xs">${simStats.events.length ? each(simStats.events, (event) => {
    return `<div class="text-gray-400 border-l-2 border-gray-700 pl-2 py-1">${escape(event)} </div>`;
  }) : `<div class="text-gray-600 italic text-center mt-10" data-svelte-h="svelte-1wo3kiy">No recent events
                                </div>`}</div></div></div></div></div></div>` : ``}`;
});
const hapticEnabled = writable(true);
if (typeof localStorage !== "undefined") {
  const stored = localStorage.getItem("hapticEnabled");
  if (stored !== null) {
    hapticEnabled.set(stored === "true");
  }
}
hapticEnabled.subscribe((value) => {
  if (typeof localStorage !== "undefined") {
    localStorage.setItem("hapticEnabled", String(value));
  }
});
hapticEnabled.subscribe((value) => {
});
const css = {
  code: ".messages-container.svelte-lcmnji::-webkit-scrollbar{width:8px}.messages-container.svelte-lcmnji::-webkit-scrollbar-track{background:rgba(0, 0, 0, 0.3)}.messages-container.svelte-lcmnji::-webkit-scrollbar-thumb{background:rgba(55, 65, 81, 0.5);border-radius:4px}.messages-container.svelte-lcmnji::-webkit-scrollbar-thumb:hover{background:rgba(75, 85, 99, 0.7)}",
  map: '{"version":3,"file":"+page.svelte","sources":["+page.svelte"],"sourcesContent":["<script lang=\\"ts\\">import { onMount, onDestroy, tick } from \\"svelte\\";\\nimport { goto } from \\"$app/navigation\\";\\nimport { gameAPI } from \\"$lib/services/api\\";\\nimport { gameWebSocket } from \\"$lib/services/websocket\\";\\nimport WorldEntry from \\"$lib/components/WorldEntry.svelte\\";\\nimport CharacterSheet from \\"$lib/components/Character/CharacterSheet.svelte\\";\\nimport WorldMapModal from \\"$lib/components/Map/WorldMapModal.svelte\\";\\nimport CommandInput from \\"$lib/components/Input/CommandInput.svelte\\";\\nimport QuickButtons from \\"$lib/components/Input/QuickButtons.svelte\\";\\nlet onboardingStep = \\"checking\\";\\nlet interviewSessionId = null;\\nlet currentQuestion = \\"\\";\\nlet userResponse = \\"\\";\\nlet conversationHistory = [];\\nlet showEntryModal = false;\\nlet entryOptions = null;\\nlet targetWorldId = null;\\nlet messages = [];\\nlet commandInput = \\"\\";\\nlet unsubscribe = null;\\nlet isConnected = false;\\nlet currentCharacterId = null;\\nlet showCharacterSheet = false;\\nlet characterSkills = {};\\nlet characterStats = {\\n  name: \\"Adventurer\\",\\n  level: 1,\\n  experience: 0,\\n  nextLevelXP: 100,\\n  attributes: {\\n    strength: 10,\\n    dexterity: 10,\\n    constitution: 10,\\n    intelligence: 10,\\n    wisdom: 10,\\n    charisma: 10\\n  }\\n};\\nlet showWorldMap = false;\\nlet latestSimEvent = null;\\nlet currentUser = null;\\nconst API_URL = \\"/api\\";\\nonMount(async () => {\\n  try {\\n    currentUser = await gameAPI.getMe();\\n  } catch (err) {\\n    goto(\\"/\\");\\n    return;\\n  }\\n  const unsubscribeConnection = gameWebSocket.connected.subscribe(\\n    (value) => {\\n      isConnected = value;\\n    }\\n  );\\n  unsubscribe = gameWebSocket.onMessage(handleServerMessage);\\n  const originalUnsubscribe = unsubscribe;\\n  unsubscribe = () => {\\n    if (originalUnsubscribe) originalUnsubscribe();\\n    unsubscribeConnection();\\n  };\\n  await checkOnboardingStatus();\\n});\\nonDestroy(() => {\\n  if (unsubscribe) unsubscribe();\\n});\\nasync function checkOnboardingStatus() {\\n  try {\\n    const interviewRes = await fetch(\\n      `${API_URL}/world/interview/active`,\\n      {\\n        credentials: \\"include\\"\\n        // Send cookies\\n      }\\n    );\\n    if (interviewRes.ok) {\\n      const interview = await interviewRes.json();\\n      if (interview && interview.status === \\"in_progress\\") {\\n        onboardingStep = \\"interview\\";\\n        interviewSessionId = interview.session_id;\\n        if (interview.question === \\"The interview is already complete.\\" || interview.question === \\"This interview is already complete.\\") {\\n          addMessage(\\n            \\"system\\",\\n            \\"World interview previously completed.\\"\\n          );\\n          setTimeout(() => {\\n            joinLobby();\\n          }, 1e3);\\n          return;\\n        }\\n        conversationHistory = interview.conversation || [];\\n        if (conversationHistory.length > 0) {\\n          const lastMessage = conversationHistory[conversationHistory.length - 1];\\n          if (lastMessage.role === \\"assistant\\") {\\n            currentQuestion = lastMessage.text;\\n          }\\n        } else if (interview.question) {\\n          currentQuestion = interview.question;\\n          addMessage(\\"interview\\", currentQuestion);\\n        }\\n        addMessage(\\n          \\"system\\",\\n          \\"Resuming your world creation interview...\\"\\n        );\\n        return;\\n      }\\n    }\\n    if (currentUser?.last_world_id) {\\n      try {\\n        const data = await gameAPI.getCharacters();\\n        if (data && data.characters) {\\n          const char = data.characters.find(\\n            (c) => c.world_id === currentUser?.last_world_id\\n          );\\n          if (char) {\\n            await joinGame(char.character_id);\\n            return;\\n          }\\n        }\\n      } catch (e) {\\n        console.error(\\"Auto-resume check failed\\", e);\\n      }\\n    }\\n    await joinLobby();\\n  } catch (error) {\\n    console.error(\\"Onboarding check failed:\\", error);\\n    onboardingStep = \\"game\\";\\n    addMessage(\\n      \\"error\\",\\n      \\"Failed to check status. Starting in game mode.\\"\\n    );\\n    joinLobby();\\n  }\\n}\\nasync function joinLobby() {\\n  console.log(\\"[Lobby] Joining lobby...\\");\\n  try {\\n    console.log(\\"[Lobby] Disconnecting existing WebSocket...\\");\\n    gameWebSocket.disconnect();\\n    await new Promise((resolve) => setTimeout(resolve, 100));\\n    console.log(\\"[Lobby] Connecting to WebSocket...\\");\\n    gameWebSocket.connect();\\n    onboardingStep = \\"lobby\\";\\n    console.log(\\"[Lobby] Lobby join complete\\");\\n  } catch (error) {\\n    console.error(\\"[Lobby] Failed to join lobby:\\", error);\\n    addMessage(\\"error\\", \\"Failed to join lobby.\\");\\n  }\\n}\\nasync function startWorldInterview() {\\n  try {\\n    const response = await fetch(`${API_URL}/world/interview/start`, {\\n      method: \\"POST\\",\\n      headers: {\\n        \\"Content-Type\\": \\"application/json\\"\\n      },\\n      credentials: \\"include\\"\\n      // Send cookies\\n    });\\n    if (!response.ok) {\\n      const errorText = await response.text();\\n      console.error(\\n        \\"Interview start failed:\\",\\n        response.status,\\n        errorText\\n      );\\n      throw new Error(\\n        `Failed to start interview: ${response.status}`\\n      );\\n    }\\n    const data = await response.json();\\n    console.log(\\"Interview started:\\", data);\\n    if (!data.session_id || !data.question) {\\n      console.error(\\"Invalid interview response:\\", data);\\n      throw new Error(\\"Invalid response from server\\");\\n    }\\n    interviewSessionId = data.session_id;\\n    currentQuestion = data.question || \\"Tell me about the world you\'d like to create.\\";\\n    conversationHistory.push({\\n      role: \\"assistant\\",\\n      text: currentQuestion\\n    });\\n    addMessage(\\"interview\\", currentQuestion);\\n    onboardingStep = \\"interview\\";\\n  } catch (error) {\\n    console.error(\\"Failed to start interview:\\", error);\\n    addMessage(\\n      \\"error\\",\\n      error.message || \\"Failed to start world interview. Please try again.\\"\\n    );\\n  }\\n}\\nasync function sendInterviewResponse() {\\n  if (!userResponse.trim() || !interviewSessionId) return;\\n  const userMessage = userResponse.trim();\\n  conversationHistory.push({ role: \\"user\\", text: userMessage });\\n  addMessage(\\"user\\", userMessage);\\n  userResponse = \\"\\";\\n  try {\\n    addMessage(\\"system\\", \\"Thinking... (this may take 10-20 seconds)\\");\\n    const controller = new AbortController();\\n    const timeoutId = setTimeout(() => controller.abort(), 6e4);\\n    const response = await fetch(`${API_URL}/world/interview/message`, {\\n      method: \\"POST\\",\\n      headers: {\\n        \\"Content-Type\\": \\"application/json\\"\\n      },\\n      credentials: \\"include\\",\\n      // Send cookies\\n      body: JSON.stringify({\\n        session_id: interviewSessionId,\\n        message: userMessage\\n      }),\\n      signal: controller.signal\\n    });\\n    clearTimeout(timeoutId);\\n    if (!response.ok) {\\n      const errorText = await response.text();\\n      console.error(\\n        \\"Interview message failed:\\",\\n        response.status,\\n        errorText\\n      );\\n      throw new Error(`Failed to send message: ${response.status}`);\\n    }\\n    const data = await response.json();\\n    console.log(\\"Interview response:\\", data);\\n    if (data.completed || data.question === \\"The interview is already complete.\\" || data.question === \\"This interview is already complete.\\") {\\n      addMessage(\\n        \\"system\\",\\n        \\"World interview complete! Creating your world...\\"\\n      );\\n      if (data.question && !data.question.includes(\\"already complete\\")) {\\n        conversationHistory.push({\\n          role: \\"assistant\\",\\n          text: data.question\\n        });\\n        addMessage(\\"interview\\", data.question);\\n      }\\n      setTimeout(() => {\\n        joinLobby();\\n        addMessage(\\n          \\"system\\",\\n          \\"World created! Use \'worlds\' to see it.\\"\\n        );\\n      }, 2e3);\\n    } else {\\n      const nextQuestion = data.next_question || data.question || data.response || \\"Please continue...\\";\\n      currentQuestion = nextQuestion;\\n      conversationHistory.push({\\n        role: \\"assistant\\",\\n        text: nextQuestion\\n      });\\n      addMessage(\\"interview\\", nextQuestion);\\n    }\\n  } catch (error) {\\n    console.error(\\"Failed to send response:\\", error);\\n    addMessage(\\n      \\"error\\",\\n      error.message || \\"Failed to process your response. Please try again.\\"\\n    );\\n  }\\n}\\nasync function handleCommand(cmd) {\\n  const input = cmd ? cmd.trim() : commandInput.trim();\\n  if (!input) return;\\n  addMessage(\\"player\\", `> ${input}`);\\n  if (onboardingStep === \\"interview\\") {\\n    userResponse = input;\\n    commandInput = \\"\\";\\n    sendInterviewResponse();\\n    return;\\n  }\\n  if (input.toLowerCase().startsWith(\\"create character\\")) {\\n    await handleCharacterCommand(input);\\n    if (!cmd) commandInput = \\"\\";\\n    return;\\n  }\\n  if (input.trim().toLowerCase() === \\"status\\") {\\n    openCharacterSheet();\\n    if (!cmd) commandInput = \\"\\";\\n    return;\\n  }\\n  gameWebSocket.sendCommandWithQueue(input);\\n  if (!cmd) commandInput = \\"\\";\\n}\\nasync function listWorlds() {\\n  try {\\n    const res = await fetch(`${API_URL}/game/worlds`, {\\n      credentials: \\"include\\"\\n      // Send cookies\\n    });\\n    if (res.ok) {\\n      const worlds = await res.json();\\n      addMessage(\\"system\\", \\"Available Worlds:\\");\\n      worlds.forEach((w) => {\\n        addMessage(\\"system\\", `- ${w.Name} (ID: ${w.ID})`);\\n      });\\n      addMessage(\\"system\\", \\"Type \'enter <world_id>\' to enter.\\");\\n    } else {\\n      addMessage(\\"error\\", \\"Failed to list worlds.\\");\\n    }\\n  } catch (e) {\\n    addMessage(\\"error\\", \\"Failed to list worlds.\\");\\n  }\\n}\\nasync function enterWorld(worldId) {\\n  try {\\n    addMessage(\\n      \\"system\\",\\n      `Checking entry options for world ${worldId}...`\\n    );\\n    const res = await fetch(\\n      `${API_URL}/game/entry-options?world_id=${worldId}`,\\n      {\\n        credentials: \\"include\\"\\n        // Send cookies\\n      }\\n    );\\n    if (res.ok) {\\n      const options = await res.json();\\n      entryOptions = options;\\n      targetWorldId = worldId;\\n      showEntryModal = true;\\n    } else {\\n      const err = await res.text();\\n      addMessage(\\"error\\", `Cannot enter world: ${err}`);\\n    }\\n  } catch (e) {\\n    addMessage(\\"error\\", \\"Failed to get entry options.\\");\\n  }\\n}\\nasync function handleEntrySelection(event) {\\n  const { type, data } = event.detail;\\n  if (!targetWorldId) return;\\n  showEntryModal = false;\\n  try {\\n    if (type === \\"cancel\\") {\\n      targetWorldId = null;\\n      return;\\n    }\\n    if (type === \\"watcher\\") {\\n      await createCharacter(\\n        \\"Watcher\\",\\n        \\"Spirit\\",\\n        targetWorldId,\\n        \\"An invisible observer.\\",\\n        \\"Watcher\\",\\n        \\"watcher\\"\\n      );\\n      return;\\n    }\\n    if (type === \\"npc\\") {\\n      const npc = data;\\n      await createCharacter(\\n        npc.name,\\n        npc.species,\\n        targetWorldId,\\n        npc.description,\\n        npc.occupation,\\n        \\"player\\",\\n        npc.appearance\\n      );\\n    }\\n    if (type === \\"custom\\") {\\n      onboardingStep = \\"character\\";\\n      addMessage(\\n        \\"system\\",\\n        \\"Enter: create character <name> <species>\\"\\n      );\\n    }\\n  } catch (e) {\\n    console.error(e);\\n    addMessage(\\"error\\", \\"Entry failed.\\");\\n  }\\n}\\nasync function createCharacter(name, species, worldId, description, occupation, role, appearance) {\\n  try {\\n    const response = await fetch(`${API_URL}/game/characters`, {\\n      method: \\"POST\\",\\n      headers: {\\n        \\"Content-Type\\": \\"application/json\\"\\n      },\\n      credentials: \\"include\\",\\n      // Send cookies\\n      body: JSON.stringify({\\n        world_id: worldId,\\n        name,\\n        species,\\n        role,\\n        description,\\n        occupation,\\n        appearance\\n      })\\n    });\\n    if (!response.ok) {\\n      const errorData = await response.json();\\n      let errorMessage = \\"Failed to create character\\";\\n      if (typeof errorData.error === \\"string\\") {\\n        errorMessage = errorData.error;\\n      } else if (errorData.error && errorData.error.message) {\\n        errorMessage = errorData.error.message;\\n      }\\n      throw new Error(errorMessage);\\n    }\\n    const data = await response.json();\\n    addMessage(\\n      \\"system\\",\\n      `Character \\"${name}\\" created! Joining world...`\\n    );\\n    await joinGame(data.character.character_id);\\n  } catch (error) {\\n    addMessage(\\"error\\", error.message);\\n  }\\n}\\nasync function joinGame(characterId) {\\n  try {\\n    const joinResponse = await fetch(`${API_URL}/game/join`, {\\n      method: \\"POST\\",\\n      headers: {\\n        \\"Content-Type\\": \\"application/json\\"\\n      },\\n      credentials: \\"include\\",\\n      // Send cookies\\n      body: JSON.stringify({\\n        character_id: characterId\\n      })\\n    });\\n    if (!joinResponse.ok) {\\n      const joinError = await joinResponse.json();\\n      console.error(\\"Failed to join game:\\", joinError);\\n      throw new Error(\\"Failed to join game session.\\");\\n    }\\n    const joinData = await joinResponse.json();\\n    gameWebSocket.disconnect();\\n    gameWebSocket.connect(characterId);\\n    currentCharacterId = characterId;\\n    onboardingStep = \\"game\\";\\n    if (joinData.message) {\\n      addMessage(\\"system\\", joinData.message);\\n    } else {\\n      addMessage(\\"system\\", \\"You have entered the world!\\");\\n    }\\n  } catch (e) {\\n    throw e;\\n  }\\n}\\nasync function handleCharacterCommand(cmd) {\\n  const parts = cmd.toLowerCase().split(\\" \\");\\n  if (parts[0] === \\"create\\" && parts[1] === \\"character\\" && parts.length >= 4) {\\n    const name = parts[2];\\n    const species = parts[3].charAt(0).toUpperCase() + parts[3].slice(1);\\n    const worldId = targetWorldId || \\"00000000-0000-0000-0000-000000000001\\";\\n    await createCharacter(name, species, worldId);\\n  } else {\\n    addMessage(\\n      \\"error\\",\\n      \\"Invalid command. Use: create character <name> <species>\\"\\n    );\\n  }\\n}\\nfunction handleServerMessage(msg) {\\n  switch (msg.type) {\\n    case \\"game_message\\":\\n      const type = msg.data.type;\\n      if (type === \\"trigger_entry_options\\") {\\n        const worldId = msg.data.metadata?.world_id || msg.data.text;\\n        enterWorld(worldId);\\n      } else if (type === \\"start_interview\\") {\\n        startWorldInterview();\\n      } else {\\n        addMessage(type, msg.data.text);\\n      }\\n      break;\\n    case \\"error\\":\\n      addMessage(\\"error\\", msg.data.message);\\n      break;\\n      break;\\n    case \\"sim_event\\":\\n      latestSimEvent = msg;\\n      if (msg.data.text && msg.data.text.includes(\\"Simulation finished\\")) {\\n        console.log(\\"Simulation finished detected, opening map.\\");\\n        showWorldMap = true;\\n      }\\n      if (msg.data.importance && msg.data.importance === \\"high\\") {\\n        addMessage(\\n          \\"system\\",\\n          `[WORLD EVENT] ${msg.data.description || msg.data.text}`\\n        );\\n      }\\n      break;\\n  }\\n}\\nasync function addMessage(type, text) {\\n  let shouldScroll = false;\\n  const container = document.getElementById(\\"game-output\\");\\n  if (container) {\\n    const { scrollTop, scrollHeight, clientHeight } = container;\\n    if (scrollHeight - scrollTop - clientHeight < 100) {\\n      shouldScroll = true;\\n    }\\n  } else {\\n    shouldScroll = true;\\n  }\\n  messages = [\\n    ...messages,\\n    {\\n      id: Date.now().toString() + Math.random(),\\n      type,\\n      text,\\n      timestamp: /* @__PURE__ */ new Date()\\n    }\\n  ];\\n  await tick();\\n  if (shouldScroll && container) {\\n    container.scrollTop = container.scrollHeight;\\n  }\\n}\\nfunction handleLogout() {\\n  gameWebSocket.disconnect();\\n  gameAPI.logout();\\n  goto(\\"/\\");\\n}\\nfunction getMessageColor(type) {\\n  switch (type) {\\n    case \\"error\\":\\n      return \\"text-red-400\\";\\n    case \\"system\\":\\n      return \\"text-cyan-400\\";\\n    case \\"interview\\":\\n      return \\"text-purple-400\\";\\n    case \\"command\\":\\n      return \\"text-gray-500\\";\\n    case \\"user\\":\\n      return \\"text-blue-400\\";\\n    case \\"success\\":\\n      return \\"text-green-400\\";\\n    default:\\n      return \\"text-gray-300\\";\\n  }\\n}\\nasync function openCharacterSheet() {\\n  if (!currentCharacterId) {\\n    addMessage(\\"error\\", \\"No active character.\\");\\n    return;\\n  }\\n  try {\\n    const data = await gameAPI.getSkills(currentCharacterId);\\n    characterSkills = data.skills || {};\\n    showCharacterSheet = true;\\n  } catch (e) {\\n    console.error(e);\\n    addMessage(\\"error\\", \\"Failed to load skills.\\");\\n  }\\n}\\n<\/script>\\n\\n<div class=\\"flex flex-col h-screen bg-gray-900 text-gray-100 font-mono\\">\\n    <!-- Header -->\\n    <header\\n        class=\\"bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center\\"\\n    >\\n        <h1 class=\\"text-xl font-bold text-blue-400\\">Thousand Worlds</h1>\\n        <div class=\\"flex items-center gap-4\\">\\n            <!-- Connection Status -->\\n            <div\\n                class=\\"flex items-center gap-2 text-sm\\"\\n                title={isConnected ? \\"Connected\\" : \\"Disconnected\\"}\\n            >\\n                <div\\n                    class={`w-3 h-3 rounded-full ${isConnected ? \\"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)] connected\\" : \\"bg-red-500 animate-pulse\\"}`}\\n                ></div>\\n                <span class={isConnected ? \\"text-gray-400\\" : \\"text-red-400\\"}>\\n                    {isConnected ? \\"Connected\\" : \\"Reconnecting...\\"}\\n                </span>\\n            </div>\\n\\n            {#if onboardingStep === \\"game\\"}\\n                <button\\n                    on:click={openCharacterSheet}\\n                    class=\\"bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-sm transition-colors\\"\\n                >\\n                    Character\\n                </button>\\n                <button\\n                    on:click={() => (showWorldMap = true)}\\n                    class=\\"bg-purple-600 hover:bg-purple-500 text-white px-3 py-1 rounded text-sm transition-colors\\"\\n                >\\n                    World Map\\n                </button>\\n            {/if}\\n            <button\\n                on:click={() => {\\n                    gameAPI.logout();\\n                    goto(\\"/\\");\\n                }}\\n                class=\\"text-sm text-gray-400 hover:text-white transition-colors\\"\\n            >\\n                Logout\\n            </button>\\n        </div>\\n    </header>\\n\\n    <!-- Main Game Area -->\\n    <main class=\\"flex-1 overflow-hidden flex flex-col relative\\">\\n        {#if onboardingStep === \\"checking\\"}\\n            <div class=\\"flex-1 flex items-center justify-center\\">\\n                <div class=\\"text-xl text-gray-400 animate-pulse\\">\\n                    Loading...\\n                </div>\\n            </div>\\n        {:else if onboardingStep === \\"interview\\"}\\n            <div\\n                class=\\"flex-1 flex flex-col p-4 overflow-y-auto\\"\\n                id=\\"game-output\\"\\n                data-testid=\\"game-output\\"\\n            >\\n                {#each conversationHistory as msg}\\n                    <div\\n                        class={`mb-4 ${msg.role === \\"user\\" ? \\"text-right\\" : \\"text-left\\"}`}\\n                    >\\n                        <div\\n                            class={`inline-block p-3 rounded-lg max-w-[80%] ${\\n                                msg.role === \\"user\\"\\n                                    ? \\"bg-blue-900/50 text-blue-100\\"\\n                                    : \\"bg-gray-800/50 text-gray-100\\"\\n                            }`}\\n                        >\\n                            {msg.text}\\n                        </div>\\n                    </div>\\n                {/each}\\n                {#if currentQuestion}\\n                    <div class=\\"mb-4 text-left\\">\\n                        <div\\n                            class=\\"inline-block p-3 rounded-lg max-w-[80%] bg-gray-800/50 text-gray-100 border-l-4 border-blue-500\\"\\n                        >\\n                            {currentQuestion}\\n                        </div>\\n                    </div>\\n                {/if}\\n            </div>\\n        {:else}\\n            <!-- Game Output -->\\n            <div\\n                class=\\"flex-1 overflow-y-auto p-4 space-y-2 scroll-smooth\\"\\n                id=\\"game-output\\"\\n                data-testid=\\"game-output\\"\\n            >\\n                {#each messages as msg (msg.id)}\\n                    <div\\n                        class={`message leading-relaxed ${\\n                            msg.type === \\"error\\"\\n                                ? \\"text-red-400\\"\\n                                : msg.type === \\"system\\"\\n                                  ? \\"text-yellow-400\\"\\n                                  : msg.type === \\"player\\"\\n                                    ? \\"text-blue-300\\"\\n                                    : msg.type === \\"emote\\"\\n                                      ? \\"text-orange-300 italic\\"\\n                                      : \\"text-gray-300\\"\\n                        }`}\\n                    >\\n                        {@html msg.text.replace(/\\\\n/g, \\"<br>\\")}\\n                    </div>\\n                {/each}\\n            </div>\\n        {/if}\\n\\n        <!-- Input Area -->\\n        <div class=\\"p-4 bg-gray-800 border-t border-gray-700 space-y-3\\">\\n            {#if onboardingStep !== \\"interview\\" && onboardingStep !== \\"checking\\"}\\n                <QuickButtons on:submit={(e) => handleCommand(e.detail)} />\\n            {/if}\\n\\n            {#if onboardingStep === \\"interview\\"}\\n                <!-- Interview mode: simple input -->\\n                <div class=\\"relative\\">\\n                    <input\\n                        type=\\"text\\"\\n                        bind:value={commandInput}\\n                        on:keydown={(e) => e.key === \\"Enter\\" && handleCommand()}\\n                        placeholder=\\"Answer the question...\\"\\n                        class=\\"w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 text-gray-100 text-base focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all\\"\\n                        style=\\"font-size: 16px;\\"\\n                    />\\n                </div>\\n            {:else if onboardingStep !== \\"checking\\"}\\n                <!-- Game mode: use thin-client CommandInput -->\\n                <CommandInput on:submit={(e) => handleCommand(e.detail)} />\\n            {/if}\\n        </div>\\n\\n        <!-- Entry Modal -->\\n\\n        {#if showEntryModal && entryOptions}\\n            <WorldEntry\\n                options={entryOptions}\\n                on:select={handleEntrySelection}\\n            />\\n        {/if}\\n\\n        <!-- Character Sheet Modal -->\\n        {#if showCharacterSheet}\\n            <div\\n                class=\\"absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50 transition-opacity\\"\\n                role=\\"button\\"\\n                tabindex=\\"0\\"\\n                on:click={() => (showCharacterSheet = false)}\\n                on:keydown={(e) =>\\n                    e.key === \\"Escape\\" && (showCharacterSheet = false)}\\n            >\\n                <div\\n                    class=\\"relative max-w-md w-full\\"\\n                    role=\\"document\\"\\n                    on:click|stopPropagation\\n                    on:keydown|stopPropagation\\n                    tabindex=\\"-1\\"\\n                >\\n                    <button\\n                        class=\\"absolute -top-2 -right-2 bg-gray-700 rounded-full w-8 h-8 flex items-center justify-center text-white hover:bg-gray-600 z-10\\"\\n                        on:click={() => (showCharacterSheet = false)}\\n                        data-testid=\\"close-character-sheet\\"\\n                    >\\n                        ✕\\n                    </button>\\n                    <CharacterSheet\\n                        characterName={characterStats.name}\\n                        level={characterStats.level}\\n                        experience={characterStats.experience}\\n                        nextLevelXP={characterStats.nextLevelXP}\\n                        strength={characterStats.attributes.strength}\\n                        dexterity={characterStats.attributes.dexterity}\\n                        constitution={characterStats.attributes.constitution}\\n                        intelligence={characterStats.attributes.intelligence}\\n                        wisdom={characterStats.attributes.wisdom}\\n                        charisma={characterStats.attributes.charisma}\\n                        skills={characterSkills}\\n                    />\\n                </div>\\n            </div>\\n        {/if}\\n\\n        <!-- World Map Modal -->\\n        <WorldMapModal\\n            isOpen={showWorldMap}\\n            onClose={() => (showWorldMap = false)}\\n            {latestSimEvent}\\n        />\\n    </main>\\n</div>\\n\\n<style>\\n    .messages-container::-webkit-scrollbar {\\n        width: 8px;\\n    }\\n\\n    .messages-container::-webkit-scrollbar-track {\\n        background: rgba(0, 0, 0, 0.3);\\n    }\\n\\n    .messages-container::-webkit-scrollbar-thumb {\\n        background: rgba(55, 65, 81, 0.5);\\n        border-radius: 4px;\\n    }\\n\\n    .messages-container::-webkit-scrollbar-thumb:hover {\\n        background: rgba(75, 85, 99, 0.7);\\n    }\\n</style>\\n"],"names":[],"mappings":"AAgvBI,iCAAmB,mBAAoB,CACnC,KAAK,CAAE,GACX,CAEA,iCAAmB,yBAA0B,CACzC,UAAU,CAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CACjC,CAEA,iCAAmB,yBAA0B,CACzC,UAAU,CAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CACjC,aAAa,CAAE,GACnB,CAEA,iCAAmB,yBAAyB,MAAO,CAC/C,UAAU,CAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,CACpC"}'
};
const Page = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let showWorldMap = false;
  let latestSimEvent = null;
  onDestroy(() => {
  });
  $$result.css.add(css);
  return `<div class="flex flex-col h-screen bg-gray-900 text-gray-100 font-mono"> <header class="bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center"><h1 class="text-xl font-bold text-blue-400" data-svelte-h="svelte-1p9gpg2">Thousand Worlds</h1> <div class="flex items-center gap-4"> <div class="flex items-center gap-2 text-sm"${add_attribute("title", "Disconnected", 0)}><div class="${escape(
    null_to_empty(`w-3 h-3 rounded-full ${"bg-red-500 animate-pulse"}`),
    true
  ) + " svelte-lcmnji"}"></div> <span${add_attribute("class", "text-red-400", 0)}>${escape("Reconnecting...")}</span></div> ${``} <button class="text-sm text-gray-400 hover:text-white transition-colors" data-svelte-h="svelte-fhceqg">Logout</button></div></header>  <main class="flex-1 overflow-hidden flex flex-col relative">${`<div class="flex-1 flex items-center justify-center" data-svelte-h="svelte-1nxqtd8"><div class="text-xl text-gray-400 animate-pulse">Loading...</div></div>`}  <div class="p-4 bg-gray-800 border-t border-gray-700 space-y-3">${``} ${`${``}`}</div>  ${``}  ${``}  ${validate_component(WorldMapModal, "WorldMapModal").$$render(
    $$result,
    {
      isOpen: showWorldMap,
      onClose: () => showWorldMap = false,
      latestSimEvent
    },
    {},
    {}
  )}</main> </div>`;
});
export {
  Page as default
};
